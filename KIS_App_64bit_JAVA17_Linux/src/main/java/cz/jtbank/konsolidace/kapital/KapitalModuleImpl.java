package cz.jtbank.konsolidace.kapital;
import oracle.jbo.server.ApplicationModuleImpl;
import oracle.jbo.server.ViewLinkImpl;
import oracle.jbo.server.DBTransaction;
import java.sql.*;
import cz.jtbank.konsolidace.common.KisException;
import cz.jtbank.konsolidace.doklady.KpKtgUcetnispolecnostViewImpl;
import cz.jtbank.konsolidace.protistrany.KpKtgSpolecnostViewImpl;
import cz.jtbank.konsolidace.mustky.KpTmpCissubjectViewImpl;
import oracle.jbo.ViewObject;
import oracle.jbo.Row;
//  ---------------------------------------------------------------
//  ---    File generated by Oracle Business Components for Java.
//  ---------------------------------------------------------------

public class KapitalModuleImpl extends ApplicationModuleImpl implements cz.jtbank.konsolidace.kapital.common.KapitalModule 
{
  /**
   * 
   * This is the default constructor (do not remove)
   */
  public KapitalModuleImpl()
  {
  }

  public void typNastroje(String akce,
                          int id,
                          String popis,
                          java.sql.Date dtOd,
                          java.sql.Date dtDo) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_KTG_TYPNASTROJE "+
                                            "(ID, S_POPIS, DT_PLATNOSTOD, DT_PLATNOSTDO) "+
                                            "SELECT NVL(MAX(ID),0)+1,?,?,? FROM DB_JT.KP_KTG_TYPNASTROJE",0);
        st.setString(1, popis);
        st.setDate(2, dtOd);
        st.setDate(3, dtDo);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury typNastroje akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_KTG_TYPNASTROJE "+
                                            "SET S_POPIS=?, DT_PLATNOSTOD=?, DT_PLATNOSTDO=? "+
                                            "WHERE ID=?",0);
        st.setString(1, popis);
        st.setDate(2, dtOd);
        st.setDate(3, dtDo);
        st.setInt(4, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury typNastroje akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_KTG_TYPNASTROJE "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury typNastroje akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void typOperace(String akce,
                         int id,
                         String popis,
                         int idTN,
                         java.sql.Date dtOd,
                         java.sql.Date dtDo,
                         String implBanka,
                         String implOstatni) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_KTG_TYPOPERACE "+
                                            "(ID, S_POPIS, ID_TYPNASTROJE, DT_PLATNOSTOD, DT_PLATNOSTDO, C_IMPLICITNIBANKA, C_IMPLICITNIOSTATNI) "+
                                            "SELECT NVL(MAX(ID),0)+1,?,?,?,?,?,? FROM DB_JT.KP_KTG_TYPOPERACE",0);
        st.setString(1, popis);
        st.setInt(2,idTN);
        st.setDate(3, dtOd);
        st.setDate(4, dtDo);
        st.setString(5, implBanka);
        st.setString(6, implOstatni);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury typOperace akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_KTG_TYPOPERACE "+
                                            "SET S_POPIS=?, ID_TYPNASTROJE=?, DT_PLATNOSTOD=?, DT_PLATNOSTDO=?, C_IMPLICITNIBANKA=?, C_IMPLICITNIOSTATNI=? "+
                                            "WHERE ID=?",0);
        st.setString(1, popis);
        st.setInt(2, idTN);
        st.setDate(3, dtOd);
        st.setDate(4, dtDo);
        st.setString(5, implBanka);
        st.setString(6, implOstatni);
        st.setInt(7, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury typOperace akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_KTG_TYPOPERACE "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury typOperace akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void prevodnikNastroju(String akce,
                                int id,
                                int typNas,
                                int idBunka,
                                java.sql.Date dtOd,
                                java.sql.Date dtDo,
                                String vyuzBanka,
                                String vyuzNeBanka,
                                String produktDruh,
                                String produktTyp) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("SELECT NVL(MAX(ID),0)+1 FROM DB_JT.KP_DEF_LISTBUNKANASTROJ",0);
        ResultSet rs = st.executeQuery();
        if(rs.next()) 
        {
          id = rs.getInt(1);
        }
        rs.close();
        st.close();

        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_DEF_LISTBUNKANASTROJ "+
                                            "(ID, ID_TYPNASTROJE, ID_DEFLISTBUNKA, DT_PLATNOSTOD, DT_PLATNOSTDO, C_KONTROLABANKA, C_KONTROLAMIMOBANKU, ID_PRODUKTDRUH, ID_PRODUKTTYP) "+
                                            "VALUES (?,?,?,?,?,?,?,?,?)",0);
        st.setInt(1, id);
        st.setInt(2, typNas);
        st.setInt(3, idBunka);
        st.setDate(4, dtOd);
        st.setDate(5, dtDo);
        st.setString(6, vyuzBanka);
        st.setString(7, vyuzNeBanka);
        st.setString(8, produktDruh==null?null:produktDruh.trim());
        st.setString(9, produktTyp==null?null:produktTyp.trim());
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury prevodnikNastroju akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_DEF_LISTBUNKANASTROJ "+
                                            "SET ID_TYPNASTROJE=?, ID_DEFLISTBUNKA=?, DT_PLATNOSTOD=?, DT_PLATNOSTDO=?, C_KONTROLABANKA=?, C_KONTROLAMIMOBANKU=?, ID_PRODUKTDRUH=?, ID_PRODUKTTYP=? "+
                                            "WHERE ID=?",0);
        st.setInt(1, typNas);
        st.setInt(2, idBunka);
        st.setDate(3, dtOd);
        st.setDate(4, dtDo);
        st.setString(5, vyuzBanka);
        st.setString(6, vyuzNeBanka);
        st.setString(7, produktDruh==null?null:produktDruh.trim());
        st.setString(8, produktTyp==null?null:produktTyp.trim());
        st.setInt(9, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury prevodnikNastroju akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_DEF_LISTBUNKANASTROJ "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury prevodnikNastroju akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }

    try {
      st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_LOG_LISTBUNKANASTROJ "+
                                          "(ID, ID_TYPNASTROJE, ID_DEFLISTBUNKA, DT_PLATNOSTOD, DT_PLATNOSTDO, C_KONTROLABANKA, C_KONTROLAMIMOBANKU, ID_PRODUKTDRUH, ID_PRODUKTTYP, S_AKCE, S_UZIVATEL) "+
                                          "VALUES (?,?,?,?,?,?,?,?,?,?,?)",0);
      st.setInt(1, id);
      st.setInt(2, typNas);
      st.setInt(3, idBunka);
      st.setDate(4, dtOd);
      st.setDate(5, dtDo);
      st.setString(6, vyuzBanka);
      st.setString(7, vyuzNeBanka);
      st.setString(8, produktDruh==null?null:produktDruh.trim());
      st.setString(9, produktTyp==null?null:produktTyp.trim());
      st.setString(10, akce);
      st.setString(11, cz.jtbank.konsolidace.common.Utils.getUserName(this, false));
      st.execute();
    }
    catch (SQLException s) {
      s.printStackTrace(); //pro zacatek
      throw new KisException("Selhalo volání procedury prevodnikNastroju (log) akce="+akce,s);
    }
    finally {
      try {
        if (st != null) st.close();
      } 
      catch (SQLException s) { /* ignore */}
    }
    
    dbTran.commit();
  }

  public void tdpRkc(String akce,
                     int id,
                     int idSpol,
                     String ucet,
                     java.sql.Date dtOd,
                     java.sql.Date dtDo) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_DEF_UCETPORTFOLIO "+
                                            "(ID, ID_KTGUCETNISPOLECNOST, S_UCET, DT_PLATNOSTOD, DT_PLATNOSTDO) "+
                                            "SELECT NVL(MAX(ID),0)+1,?,?,?,? FROM DB_JT.KP_DEF_UCETPORTFOLIO",0);
        st.setInt(1, idSpol);
        st.setString(2, ucet==null?null:ucet.trim());
        st.setDate(3, dtOd);
        st.setDate(4, dtDo);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury tdpRkc akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_DEF_UCETPORTFOLIO "+
                                            "SET ID_KTGUCETNISPOLECNOST=?, S_UCET=?, DT_PLATNOSTOD=?, DT_PLATNOSTDO=? "+
                                            "WHERE ID=?",0);
        st.setInt(1, idSpol);
        st.setString(2, ucet==null?null:ucet.trim());
        st.setDate(3, dtOd);
        st.setDate(4, dtDo);
        st.setInt(5, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury tdpRkc akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_DEF_UCETPORTFOLIO "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury tdpRkc akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void obdobiSYU590(String akce,
                           int id,
                           int idCis,
                           java.sql.Date dtOd,
                           java.sql.Date dtDo,
                           String kontr) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_KTG_ZISKSR "+
                                            "(ID, ID_SKUPINA, DT_PLATNOSTOD, DT_PLATNOSTDO, C_KONTROLAVYUZITI) "+
                                            "SELECT NVL(MAX(ID),0)+1,?,?,?,? FROM DB_JT.KP_KTG_ZISKSR",0);
        st.setInt(1, idCis);
        st.setDate(2, dtOd);
        st.setDate(3, dtDo);
        st.setString(4, kontr);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury obdobiSYU590 akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_KTG_ZISKSR "+
                                            "SET ID_SKUPINA=?, DT_PLATNOSTOD=?, DT_PLATNOSTDO=?, C_KONTROLAVYUZITI=? "+
                                            "WHERE ID=?",0);
        st.setInt(1, idCis);
        st.setDate(2, dtOd);
        st.setDate(3, dtDo);
        st.setString(4, kontr);
        st.setInt(5, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury obdobiSYU590 akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_KTG_ZISKSR "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury obdobiSYU590 akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void industryType(String akce,
                           String code,
                           String name,
                           String invfn) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_CIS_INDUSTRYTYPE "+
                                            "(S_CODE, S_NAME, C_INVESTICE) "+
                                            "VALUES (?,?,?)",0);
        st.setString(1, code==null?null:code.trim());
        st.setString(2, name);
        st.setString(3, invfn);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury industryType akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_CIS_INDUSTRYTYPE "+
                                            "SET S_NAME=?, C_INVESTICE=? "+
                                            "WHERE S_CODE=?",0);
        st.setString(1, name);
        st.setString(2, invfn);
        st.setString(3, code==null?null:code.trim());
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury industryType akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_CIS_INDUSTRYTYPE "+
                                            "WHERE S_CODE=?",0);
        st.setString(1, code==null?null:code.trim());
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury industryType akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void ucelUveru(String akce,
                        int id,
                        String komercni) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //UPDATE
    if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_CIS_UCELUVERU "+
                                            "SET C_KOMERCNI=? "+
                                            "WHERE ID=?",0);
        st.setString(1, komercni);
        st.setInt(2, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury ucelUveru akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_CIS_UCELUVERU "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury ucelUveru akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void cpIndex(String akce,
                      int id,
                      String extId,
                      String nazev) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_CIS_CPINDEX "+
                                            "(ID, S_EXTID, S_NAZEV) "+
                                            "SELECT NVL(MAX(ID),0)+1,?,? FROM DB_JT.KP_CIS_CPINDEX",0);
        st.setString(1, extId==null?null:extId.trim());
        st.setString(2, nazev);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury cpIndex akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_CIS_CPINDEX "+
                                            "SET S_EXTID=?, S_NAZEV=? "+
                                            "WHERE ID=?",0);
        st.setString(1, extId==null?null:extId.trim());
        st.setString(2, nazev);
        st.setInt(3, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury cpIndex akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_CIS_CPINDEX "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury cpIndex akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void typZajisteni(String akce,
                           int id,
                           int idTN) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //UPDATE
    if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_CIS_TYPZAJISTENI "+
                                            "SET ID_TYPNASTROJE=? "+
                                            "WHERE ID=?",0);
        st.setInt(1, idTN);
        st.setInt(2, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury typZajisteni akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_CIS_TYPZAJISTENI "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury typZajisteni akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void kategorieProtistran(String akce,
                                  int id,
                                  int idPs,
                                  String nazev,
                                  String licence,
                                  String srp,
                                  String likvida) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //UPDATE
    if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_CIS_KATEGORIEPROTISTRAN "+
                                            "SET ID_SPOLECNOST=?, S_NAZEV=?, C_LICENCE=?, C_SPOLECNERIZENY=?, C_LIKVIDA=? "+
                                            "WHERE ID=?",0);
        st.setInt(1, idPs);
        st.setString(2, nazev);
        st.setString(3, licence);
        st.setString(4, srp);
        st.setString(5, likvida);
        st.setInt(6, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury kategorieProtistran akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_CIS_KATEGORIEPROTISTRAN "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury kategorieProtistran akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void spolecnost(int id,
                         String licence,
                         String likvidace,
                         String srp,
                         int idExtRat,
                         String zona,
                         String zvlVztah) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    try {
      st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_KTG_SPOLECNOST "+
                                          "SET C_LICENCE=?, C_LIKVIDACE=?, C_SPOLECNERIZENY=?, C_ZONA=?, S_ZVLASTNIVZTAHKJINEMUCLENURKC=? "+
                                          "WHERE ID=?",0);
      st.setString(1, licence);
      st.setString(2, likvidace);
      st.setString(3, srp);
      st.setString(4, zona);
      st.setString(5, zvlVztah);
      st.setInt(6, id);
      st.execute();
    }
    catch (SQLException s) {
      s.printStackTrace(); //pro zacatek
      throw new KisException("Selhalo volání procedury spolecnost id="+id,s);
    }
    finally {
      try {
        if (st != null) st.close();
      } 
      catch (SQLException s) { /* ignore */}
    }

//EXTERNI RATING???
    if(idExtRat>0) 
    {
      int cnt = 0;
      try {
        st = dbTran.createPreparedStatement("SELECT COUNT(*) CNT FROM DB_JT.KP_REL_SPOLECNOSTEXTERNIRATING "+
                                            "WHERE ID_KTGSPOLECNOST=?",0);
        st.setInt(1, id);
        ResultSet rs = st.executeQuery();
        if(rs.next()) 
        {
          cnt = rs.getInt(1);
        }
        rs.close();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury spolecnost (cnt) id="+id,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
      if(cnt>0) 
      {
        try {
          st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_REL_SPOLECNOSTEXTERNIRATING "+
                                              "SET ID_EXTERNIRATING=? "+
                                              "WHERE ID_KTGSPOLECNOST=?",0);
          st.setInt(1, idExtRat);
          st.setInt(2, id);
          st.execute();
        }
        catch (SQLException s) {
          s.printStackTrace(); //pro zacatek
          throw new KisException("Selhalo volání procedury spolecnost (update) id="+id,s);
        }
        finally {
          try {
            if (st != null) st.close();
          } 
          catch (SQLException s) { /* ignore */}
        }
      }
      else 
      {
        try {
          st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_REL_SPOLECNOSTEXTERNIRATING "+
                                              "(ID_EXTERNIRATING,ID_KTGSPOLECNOST) VALUES (?,?)",0);
          st.setInt(1, idExtRat);
          st.setInt(2, id);
          st.execute();
        }
        catch (SQLException s) {
          s.printStackTrace(); //pro zacatek
          throw new KisException("Selhalo volání procedury spolecnost (insert) id="+id,s);
        }
        finally {
          try {
            if (st != null) st.close();
          } 
          catch (SQLException s) { /* ignore */}
        }
      }
    }
    else 
    {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_REL_SPOLECNOSTEXTERNIRATING "+
                                            "WHERE ID_KTGSPOLECNOST=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury spolecnost (2) id="+id,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void externiRating(String akce,
                            int id,
                            String popis,
                            double katKoef) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_CIS_EXTERNIRATING "+
                                            "(ID, S_POPIS, KATEGORIEKOEF) "+
                                            "SELECT NVL(MAX(ID),0)+1,?,? FROM DB_JT.KP_CIS_EXTERNIRATING",0);
        st.setString(1, popis);
        st.setDouble(2, katKoef);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury externiRating akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_CIS_EXTERNIRATING "+
                                            "SET S_POPIS=?, KATEGORIEKOEF=? "+
                                            "WHERE ID=?",0);
        st.setString(1, popis);
        st.setDouble(2, katKoef);
        st.setInt(3, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury externiRating akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_CIS_EXTERNIRATING "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury externiRating akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void cennyPapir(int id,
                         int idIndex) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    if(idIndex>0) 
    {
      int cnt = 0;
      try {
        st = dbTran.createPreparedStatement("SELECT COUNT(*) CNT FROM DB_JT.KP_REL_CENNYPAPIRINDEX "+
                                            "WHERE ID_CENNYPAPIR=?",0);
        st.setInt(1, id);
        ResultSet rs = st.executeQuery();
        if(rs.next()) 
        {
          cnt = rs.getInt(1);
        }
        rs.close();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury cennyPapir (cnt) id="+id,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
      if(cnt>0) 
      {
        try {
          st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_REL_CENNYPAPIRINDEX "+
                                              "SET ID_CPINDEX=? "+
                                              "WHERE ID_CENNYPAPIR=?",0);
          st.setInt(1, idIndex);
          st.setInt(2, id);
          st.execute();
        }
        catch (SQLException s) {
          s.printStackTrace(); //pro zacatek
          throw new KisException("Selhalo volání procedury cennyPapir (update) id="+id,s);
        }
        finally {
          try {
            if (st != null) st.close();
          } 
          catch (SQLException s) { /* ignore */}
        }
      }
      else 
      {
        try {
          st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_REL_CENNYPAPIRINDEX "+
                                              "(ID_CENNYPAPIR,ID_CPINDEX) VALUES (?,?)",0);
          st.setInt(1, id);
          st.setInt(2, idIndex);
          st.execute();
        }
        catch (SQLException s) {
          s.printStackTrace(); //pro zacatek
          throw new KisException("Selhalo volání procedury cennyPapir (insert) id="+id,s);
        }
        finally {
          try {
            if (st != null) st.close();
          } 
          catch (SQLException s) { /* ignore */}
        }
      }
    }
    else 
    {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_REL_CENNYPAPIRINDEX "+
                                            "WHERE ID_CENNYPAPIR=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury cennyPapir (2) id="+id,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void nastrojOperace(String akce,
                             int id,
                             int subject,
                             int operace,
                             String prodKind,
                             String prodType) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_DEF_NASTROJOPERACE "+
                                            "(ID_CISSUBJECT, ID_KTGTYPOPERACE, S_PCPRODKIND, S_PCPRODTYPE) "+
                                            "VALUES (?,?,?,?)",0);
        if(subject>0) st.setInt(1, subject); else st.setNull(1,Types.INTEGER);
        st.setInt(2, operace);
        st.setString(3, prodKind);
        st.setString(4, prodType);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury nastrojOperace akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_DEF_NASTROJOPERACE "+
                                            "SET ID_CISSUBJECT=?, ID_KTGTYPOPERACE=?, S_PCPRODKIND=?, S_PCPRODTYPE=? "+
                                            "WHERE ID=?",0);
        if(subject>0) st.setInt(1, subject); else st.setNull(1,Types.INTEGER);
        st.setInt(2, operace);
        st.setString(3, prodKind);
        st.setString(4, prodType);
        st.setInt(5, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury nastrojOperace akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_DEF_NASTROJOPERACE "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury nastrojOperace akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  /**
   * 
   * Container's getter for KpKtgTypnastrojeView1
   */
  public KpKtgTypnastrojeViewImpl getKpKtgTypnastrojeView1()
  {
    return (KpKtgTypnastrojeViewImpl)findViewObject("KpKtgTypnastrojeView1");
  }

  /**
   * 
   * Container's getter for KpKtgTypoperaceView1
   */
  public KpKtgTypoperaceViewImpl getKpKtgTypoperaceView1()
  {
    return (KpKtgTypoperaceViewImpl)findViewObject("KpKtgTypoperaceView1");
  }

  /**
   * 
   * Container's getter for KpDefListbunkanastrojView1
   */
  public KpDefListbunkanastrojViewImpl getKpDefListbunkanastrojView1()
  {
    return (KpDefListbunkanastrojViewImpl)findViewObject("KpDefListbunkanastrojView1");
  }

  /**
   * 
   * Container's getter for KpDefUcetportfolioView1
   */
  public KpDefUcetportfolioViewImpl getKpDefUcetportfolioView1()
  {
    return (KpDefUcetportfolioViewImpl)findViewObject("KpDefUcetportfolioView1");
  }

  /**
   * 
   * Container's getter for KpCisZisksrskupinaView1
   */
  public KpCisZisksrskupinaViewImpl getKpCisZisksrskupinaView1()
  {
    return (KpCisZisksrskupinaViewImpl)findViewObject("KpCisZisksrskupinaView1");
  }

  /**
   * 
   * Container's getter for KpKtgZisksrView1
   */
  public KpKtgZisksrViewImpl getKpKtgZisksrView1()
  {
    return (KpKtgZisksrViewImpl)findViewObject("KpKtgZisksrView1");
  }

  /**
   * 
   * Container's getter for KpCisIndustrytypeView1
   */
  public KpCisIndustrytypeViewImpl getKpCisIndustrytypeView1()
  {
    return (KpCisIndustrytypeViewImpl)findViewObject("KpCisIndustrytypeView1");
  }

  /**
   * 
   * Container's getter for KpCisKategorieprotistranView1
   */
  public KpCisKategorieprotistranViewImpl getKpCisKategorieprotistranView1()
  {
    return (KpCisKategorieprotistranViewImpl)findViewObject("KpCisKategorieprotistranView1");
  }

  /**
   * 
   * Container's getter for KpCisUceluveruView1
   */
  public KpCisUceluveruViewImpl getKpCisUceluveruView1()
  {
    return (KpCisUceluveruViewImpl)findViewObject("KpCisUceluveruView1");
  }

  /**
   * 
   * Container's getter for KpCisCpindexView1
   */
  public KpCisCpindexViewImpl getKpCisCpindexView1()
  {
    return (KpCisCpindexViewImpl)findViewObject("KpCisCpindexView1");
  }

  /**
   * 
   * Container's getter for KpCisTypzajisteniView1
   */
  public KpCisTypzajisteniViewImpl getKpCisTypzajisteniView1()
  {
    return (KpCisTypzajisteniViewImpl)findViewObject("KpCisTypzajisteniView1");
  }









  /**
   * 
   * Sample main for debugging Business Components code using the tester.
   */
  public static void main(String[] args)
  {
    launchTester("cz.jtbank.konsolidace.kapital", "KapitalModuleLocal");
  }

  /**
   * 
   * Container's getter for KpKtgUcetnispolecnostView1
   */
  public KpKtgUcetnispolecnostViewImpl getKpKtgUcetnispolecnostView1()
  {
    return (KpKtgUcetnispolecnostViewImpl)findViewObject("KpKtgUcetnispolecnostView1");
  }

  /**
   * 
   * Container's getter for KpKtgSpolecnostView1
   */
  public KpKtgSpolecnostViewImpl getKpKtgSpolecnostView1()
  {
    return (KpKtgSpolecnostViewImpl)findViewObject("KpKtgSpolecnostView1");
  }

  /**
   * 
   * Container's getter for KpCisExterniratingView1
   */
  public KpCisExterniratingViewImpl getKpCisExterniratingView1()
  {
    return (KpCisExterniratingViewImpl)findViewObject("KpCisExterniratingView1");
  }

  /**
   * 
   * Container's getter for KpRelSpolecnostexterniratingView1
   */
  public KpRelSpolecnostexterniratingViewImpl getKpRelSpolecnostexterniratingView1()
  {
    return (KpRelSpolecnostexterniratingViewImpl)findViewObject("KpRelSpolecnostexterniratingView1");
  }

  /**
   * 
   * Container's getter for KtgCennypapirView1
   */
  public KtgCennypapirViewImpl getKtgCennypapirView1()
  {
    return (KtgCennypapirViewImpl)findViewObject("KtgCennypapirView1");
  }

  /**
   * 
   * Container's getter for KpRelCennypapirindexView1
   */
  public KpRelCennypapirindexViewImpl getKpRelCennypapirindexView1()
  {
    return (KpRelCennypapirindexViewImpl)findViewObject("KpRelCennypapirindexView1");
  }

  /**
   * 
   * Container's getter for KpDefNastrojoperaceView1
   */
  public KpDefNastrojoperaceViewImpl getKpDefNastrojoperaceView1()
  {
    return (KpDefNastrojoperaceViewImpl)findViewObject("KpDefNastrojoperaceView1");
  }

  /**
   * 
   * Container's getter for KpTmpCissubjectView1
   */
  public KpTmpCissubjectViewImpl getKpTmpCissubjectView1()
  {
    return (KpTmpCissubjectViewImpl)findViewObject("KpTmpCissubjectView1");
  }
  
  public void updateSkupinaLike(int idSpol,
                                String skupinaLike) throws KisException
  {
    ViewObject vo = (ViewObject) getKpKtgUcetnispolecnostView1();
    vo.clearCache();
    vo.setWhereClause("ID = "+idSpol);
    if(vo.hasNext()) 
    {
      Row row = vo.next();
      if("".equals(skupinaLike)) skupinaLike=null;
      if((skupinaLike==null && row.getAttribute("SSkupinalike")!=null) || (skupinaLike!=null && !skupinaLike.equals(row.getAttribute("SSkupinalike")))) {
        row.setAttribute("SSkupinalike",skupinaLike);
      }
    }
    vo.closeRowSet();
    getDBTransaction().commit();
  }

  /**
   * 
   * Container's getter for KpCisBusinesslinieView1
   */
  public KpCisBusinesslinieViewImpl getKpCisBusinesslinieView1()
  {
    return (KpCisBusinesslinieViewImpl)findViewObject("KpCisBusinesslinieView1");
  }

  public void businessLinie(String akce,
                            int id,
                            String kod,
                            String popis,
                            double beta) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.kp_cis_businessLinie "+
                                            "(S_KOD, S_POPIS, ND_BETA) "+
                                            "VALUES (?,?,?)",0);
        st.setString(1, kod);
        st.setString(2, popis);
        st.setDouble(3, beta);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury businessLinie akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.kp_cis_businessLinie "+
                                            "SET S_KOD=?, S_POPIS=?, ND_BETA=? "+
                                            "WHERE ID=?",0);
        st.setString(1, kod);
        st.setString(2, popis);
        st.setDouble(3, beta);
        st.setInt(4, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury businessLinie akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.kp_cis_businessLinie "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury businessLinie akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  /**
   * 
   * Container's getter for KpDefUcetbusinesslinieView1
   */
  public KpDefUcetbusinesslinieViewImpl getKpDefUcetbusinesslinieView1()
  {
    return (KpDefUcetbusinesslinieViewImpl)findViewObject("KpDefUcetbusinesslinieView1");
  }

  public void ucetBusinessLinie(String akce,
                                int id,
                                String ucet,
                                int idBus,
                                int idSubj,
                                String osoba) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.kp_def_ucetBusinessLinie "+
                                            "(S_UCET, ID_CISBUSINESSLINIE, ID_CISSUBJECT, C_TYPOSOBY) "+
                                            "VALUES (?,?,?,?)",0);
        st.setString(1, ucet);
        st.setInt(2, idBus);
        st.setInt(3, idSubj);
        st.setString(4, osoba);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury ucetBusinessLinie akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.kp_def_ucetBusinessLinie "+
                                            "SET S_UCET=?, ID_CISBUSINESSLINIE=?, ID_CISSUBJECT=?, C_TYPOSOBY=? "+
                                            "WHERE ID=?",0);
        st.setString(1, ucet);
        st.setInt(2, idBus);
        st.setInt(3, idSubj);
        st.setString(4, osoba);
        st.setInt(5, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury ucetBusinessLinie akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.kp_def_ucetBusinessLinie "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury ucetBusinessLinie akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  /**
   * 
   * Container's getter for TestOperacnirizikoView1
   */
  public TestOperacnirizikoViewImpl getTestOperacnirizikoView1()
  {
    return (TestOperacnirizikoViewImpl)findViewObject("TestOperacnirizikoView1");
  }

  public void operacniRiziko(int idSpol,
                             java.sql.Date dtOd,
                             java.sql.Date dtDo) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    CallableStatement st = null;
    try {
      st = dbTran.createCallableStatement("begin db_jt.kap_kapital.p_calculateOperacniRiziko(?,?,?,?); end;",0);
      st.setInt(1, idSpol);
      st.setDate(2, dtOd);
      st.setDate(3, dtDo);
      st.setString(4, cz.jtbank.konsolidace.common.Utils.getUserName(this, false));
      st.execute();
    }
    catch (SQLException s) {
      s.printStackTrace(); //pro zacatek
      throw new KisException("Selhalo volání procedury db_jt.kap_kapital.p_calculateOperacniRiziko ",s);
    }
    finally {
      try {
        if (st != null) st.close();
      } 
      catch (SQLException s) { /* ignore */}
    }
  }

  /**
   * 
   * Container's getter for KpDefVyjimkaucetproduktView1
   */
  public KpDefVyjimkaucetproduktViewImpl getKpDefVyjimkaucetproduktView1()
  {
    return (KpDefVyjimkaucetproduktViewImpl)findViewObject("KpDefVyjimkaucetproduktView1");
  }

  public void vyjimkaUcetProdukt(String akce,
                                 String ucetOrig,
                                 int idSubj,
                                 String ucet,
                                 String popis) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_DEF_VYJIMKAUCETPRODUKT "+
                                            "(ID_CISSUBJECT, S_UCET, S_POPIS) "+
                                            "VALUES (?,?,?)",0);
        st.setInt(1, idSubj);
        st.setString(2, ucet);
        st.setString(3, popis);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury vyjimkaUcetProdukt akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_DEF_VYJIMKAUCETPRODUKT "+
                                            "SET S_UCET=?,S_POPIS=? "+
                                            "WHERE ID_CISSUBJECT=? AND S_UCET=?",0);
        st.setString(1, ucet);
        st.setString(2, popis);
        st.setInt(3, idSubj);
        st.setString(4, ucetOrig);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury vyjimkaUcetProdukt akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_DEF_VYJIMKAUCETPRODUKT "+
                                            "WHERE ID_CISSUBJECT=? AND S_UCET=?",0);
        st.setInt(1, idSubj);
        st.setString(2, ucetOrig);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury vyjimkaUcetProdukt akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void agregujDoklad(int idSpol,
                             java.sql.Date datum,
                             int krok) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    CallableStatement st = null;
    try {
      st = dbTran.createCallableStatement("begin db_jt.kap_nastroje.p_agregujDoklad(?,?,?,?); end;",0);
      st.setInt(1, idSpol);
      st.setDate(2, datum);
      st.setInt(3, krok);
      st.setString(4, cz.jtbank.konsolidace.common.Utils.getUserName(this, false));
      st.execute();
    }
    catch (SQLException s) {
      s.printStackTrace(); //pro zacatek
      throw new KisException("Selhalo volání procedury db_jt.kap_nastroje.p_agregujDoklad pro idSpol="+idSpol+",datum="+datum+",krok="+krok,s);
    }
    finally {
      try {
        if (st != null) st.close();
      } 
      catch (SQLException s) { /* ignore */}
    }
  }

  public void doplnVazby(int idSpol,
                         java.sql.Date datum) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    CallableStatement st = null;
    try {
      st = dbTran.createCallableStatement("begin db_jt.kap_nastroje.p_doplnVazbySubkonsolidace(?,?,?); end;",0);
      st.setInt(1, idSpol);
      st.setDate(2, datum);
      st.setString(3, cz.jtbank.konsolidace.common.Utils.getUserName(this, false));
      st.execute();
    }
    catch (SQLException s) {
      s.printStackTrace(); //pro zacatek
      throw new KisException("Selhalo volání procedury db_jt.kap_nastroje.p_doplnVazbySubkonsolidace pro idSpol="+idSpol+",datum="+datum,s);
    }
    finally {
      try {
        if (st != null) st.close();
      } 
      catch (SQLException s) { /* ignore */}
    }
  }

  /**
   * 
   * Container's getter for KpDatOperacnirizikoView1
   */
  public KpDatOperacnirizikoViewImpl getKpDatOperacnirizikoView1()
  {
    return (KpDatOperacnirizikoViewImpl)findViewObject("KpDatOperacnirizikoView1");
  }

  /**
   * 
   * Container's getter for KpDatOperacnirizikodetailView1
   */
  public KpDatOperacnirizikodetailViewImpl getKpDatOperacnirizikodetailView1()
  {
    return (KpDatOperacnirizikodetailViewImpl)findViewObject("KpDatOperacnirizikodetailView1");
  }

  public void orCalculate(int idSpol,
                          java.sql.Date datumOd,
                          java.sql.Date datumDo) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    CallableStatement st = null;
    try {
      st = dbTran.createCallableStatement("begin db_jt.kap_operacni_riziko.p_calculate(?,?,?,?); end;",0);
      st.setInt(1, idSpol);
      st.setDate(2, datumOd);
      st.setDate(3, datumDo);
      st.setString(4, cz.jtbank.konsolidace.common.Utils.getUserName(this, false));
      st.execute();
    }
    catch (SQLException s) {
      s.printStackTrace(); //pro zacatek
      throw new KisException("Selhalo volání procedury db_jt.kap_operacni_riziko.p_calculate pro idSpol="+idSpol+",datumOd="+datumOd+",datumDo="+datumDo,s);
    }
    finally {
      try {
        if (st != null) st.close();
      } 
      catch (SQLException s) { /* ignore */}
    }
  }

  /**
   * 
   * Container's getter for KpDefKapitalovkaduplicityView1
   */
  public KpDefKapitalovkaduplicityViewImpl getKpDefKapitalovkaduplicityView1()
  {
    return (KpDefKapitalovkaduplicityViewImpl)findViewObject("KpDefKapitalovkaduplicityView1");
  }

  /**
   * 
   * Container's getter for VwKpKpduplicitydetailView1
   */
  public VwKpKpduplicitydetailViewImpl getVwKpKpduplicitydetailView1()
  {
    return (VwKpKpduplicitydetailViewImpl)findViewObject("VwKpKpduplicitydetailView1");
  }
}