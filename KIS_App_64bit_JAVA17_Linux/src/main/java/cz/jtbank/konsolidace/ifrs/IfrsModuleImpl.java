package cz.jtbank.konsolidace.ifrs;
import cz.jtbank.konsolidace.common.KisException;
import cz.jtbank.konsolidace.excel.*;
import oracle.jbo.server.ApplicationModuleImpl;
import cz.jtbank.konsolidace.doklady.ViewJtSpolImpl;
import java.sql.*;
import java.io.*;
import oracle.jbo.server.DBTransaction;
import cz.jtbank.konsolidace.fininv.KpCisMenaViewImpl;
import cz.jtbank.konsolidace.common.Constants;
import cz.jtbank.konsolidace.doklady.ViewJtSpolUserPravaImpl;
import cz.jtbank.konsolidace.protistrany.VwProtistranaViewImpl;
import cz.jtbank.konsolidace.users.KtgAppuserViewImpl;
import cz.jtbank.konsolidace.projekt.VwKtgProjektViewImpl;
import cz.jtbank.konsolidace.projekt.KpKtgProjektViewImpl;
import cz.jtbank.konsolidace.doklady.KpKtgUcetnispolecnostViewImpl;
import cz.jtbank.konsolidace.ucskup.VwKtgUcetnispolecnostViewImpl;
import cz.jtbank.konsolidace.dokument.KpKtgOdborViewImpl;
import cz.jtbank.konsolidace.dokument.VwKtgOdborViewImpl;
import cz.jtbank.konsolidace.projekt.KpRelProjektucspolViewImpl;
import cz.jtbank.konsolidace.majetek.VwKpMajetkovaucastprehledViewImpl;
import oracle.jbo.ViewObject;
import oracle.jbo.Row;
import oracle.jbo.domain.Number;
import cz.jtbank.konsolidace.ucskup.KpKtgUcetnispolecnostLinkViewImpl;
//  ---------------------------------------------------------------
//  ---    File generated by Oracle Business Components for Java.
//  ---------------------------------------------------------------

public class IfrsModuleImpl extends ApplicationModuleImpl implements cz.jtbank.konsolidace.ifrs.common.IfrsModule 
{
  /**
   * 
   * This is the default constructor (do not remove)
   */
  public IfrsModuleImpl()
  {
  }

  /**
   * 
   * Container's getter for VwJtSpolecnostpravidlaifrsView1
   */
  public VwJtSpolecnostpravidlaifrsViewImpl getVwJtSpolecnostpravidlaifrsView1()
  {
    return (VwJtSpolecnostpravidlaifrsViewImpl)findViewObject("VwJtSpolecnostpravidlaifrsView1");
  }

  /**
   * 
   * Sample main for debugging Business Components code using the tester.
   */
  public static void main(String[] args)
  {
    launchTester("cz.jtbank.konsolidace.ifrs", "IfrsModuleLocal");
  }

  /**
   * 
   * Container's getter for ViewJtSpol1
   */
  public ViewJtSpolImpl getViewJtSpol1()
  {
    return (ViewJtSpolImpl)findViewObject("ViewJtSpol1");
  }

  /**
   * 
   * Container's getter for KpCisIfrstyppravidloView1
   */
  public KpCisIfrstyppravidloViewImpl getKpCisIfrstyppravidloView1()
  {
    return (KpCisIfrstyppravidloViewImpl)findViewObject("KpCisIfrstyppravidloView1");
  }

  private String getUser() 
  {
    String user = cz.jtbank.konsolidace.common.Utils.getUserName(this, false);
    return user;
  }

  public int currentUsersId() 
  {
    String user = cz.jtbank.konsolidace.common.Utils.getUserName(this, true);
    Number userId = null;
    
    ViewObject voUser = getKtgAppuserView1();
    voUser.clearCache();
    voUser.setWhereClause("S_USERID = '"+user+"'");
    if(voUser.hasNext()) 
    {
      Row rowUser = voUser.next();
      userId = (Number) rowUser.getAttribute("Id");
    }
    voUser.closeRowSet();
    if(userId == null) return -1;
    
    return userId.intValue();
  }
  
  public void ifrsPravidlo(String akce,
                           int id,
                           int idSpol,
                           int idPoradi,
                           int typ,
                           java.sql.Date platnostOd,
                           java.sql.Date platnostDo,
                           String poznamka,
                           String validaceUcet,
                           double validaceHodnota) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    CallableStatement st = null;
    try {
      st = dbTran.createCallableStatement("begin db_jt.kap_gui.p_KPIfrsPravidlo(?,?,?,?,?,?,?,?,?,?,?); end;",0);
      st.setString(1, akce);
      st.setInt(2, id);
      st.setInt(3, idSpol);
      st.setInt(4, idPoradi);
      st.setInt(5, typ);
      st.setString(6, poznamka);
      st.setString(7, validaceUcet==null?null:validaceUcet.trim());
      st.setDouble(8, validaceHodnota);
      st.setDate(9, platnostOd);
      st.setDate(10, platnostDo);
      st.setString(11, getUser());
      st.execute();
    }
    catch (SQLException s) {
      s.printStackTrace(); //pro zacatek
      throw new KisException("Selhalo volání procedury db_jt.kap_gui.p_KPIfrsPravidlo",s);
    }
    finally {
      try {
        if (st != null) st.close();
      } 
      catch (SQLException s) { /* ignore */}
    }
  }

  public void ifrsPravidloPlatnost(int id,
                                   java.sql.Date platnostDo) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    CallableStatement st = null;
    try {
      st = dbTran.createCallableStatement("begin db_jt.kap_gui.p_KPIfrsPravidloPlatnost (?,?,?); end;",0);
      st.setInt(1, id);
      st.setDate(2, platnostDo);
      st.setString(3, getUser());
      st.execute();
    }
    catch (SQLException s) {
      s.printStackTrace(); //pro zacatek
      throw new KisException("Selhalo volání procedury db_jt.kap_gui.p_KPIfrsPravidloPlatnost",s);
    }
    finally {
      try {
        if (st != null) st.close();
      } 
      catch (SQLException s) { /* ignore */}
    }
  }

  public void ifrsPravidloDetail(String akce,
                                 int id,
                                 int idPrav,
                                 int idPoradi,
                                 int idPoradiPodminka,
                                 int typ,
                                 String poznamka,
                                 String ucetMd,
                                 String ucetD,
                                 double castka,
                                 String mena,
                                 double castkaLocal,
                                 String ucetZbytek,
                                 String podminka,
                                 int refSpol,
                                 int proti,
                                 int poradiFix,
                                 int idProjekt,
                                 int idOdbor,
                                 String uuMd,
                                 String uuD) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    CallableStatement st = null;
    try {
      st = dbTran.createCallableStatement("begin db_jt.kap_gui.p_KPIfrsPravidloDetail(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?); end;",0);
      st.setString(1, akce);
      st.setInt(2, id);
      st.setInt(3, idPrav);
      st.setInt(4, idPoradi);
      st.setInt(5, idPoradiPodminka);
      st.setInt(6, typ);
      st.setString(7, poznamka);
      st.setString(8, ucetMd==null?null:ucetMd.trim());
      st.setString(9, ucetD==null?null:ucetD.trim());
      st.setDouble(10, castka);
      st.setString(11, mena);
      st.setDouble(12, castkaLocal);
      st.setString(13, ucetZbytek==null?null:ucetZbytek.trim());
      st.setString(14, podminka);
      if(refSpol>0) 
        st.setInt(15, refSpol);
      else
        st.setNull(15, Types.INTEGER);
      if(proti>0) 
        st.setInt(16, proti);
      else
        st.setNull(16, Types.INTEGER);
      st.setInt(17, poradiFix);
      if(idProjekt>0) 
        st.setInt(18, idProjekt);
      else
        st.setNull(18, Types.INTEGER);
      if(idOdbor>0) 
        st.setInt(19, idOdbor);
      else
        st.setNull(19, Types.INTEGER);
      st.setString(20, getUser());
      st.setString(21, uuMd==null?null:uuMd.trim());
      st.setString(22, uuD==null?null:uuD.trim());
      st.execute();
    }
    catch (SQLException s) {
      s.printStackTrace(); //pro zacatek
      throw new KisException("Selhalo volání procedury db_jt.kap_gui.p_KPIfrsPravidloDetail",s);
    }
    finally {
      try {
        if (st != null) st.close();
      } 
      catch (SQLException s) { /* ignore */}
    }
  }

  public void exportExcel(java.sql.Date datum) throws KisException 
  {
    ESExportIfrs ei = new ESExportIfrs(this, datum);
    try {
      ei.excelOutput();
    }
    catch (IOException ex) {
      ex.printStackTrace(); //pro zacatek
    }
  }
  
  protected FileFilter getFileFilter(final String name) 
  {
    return new FileFilter() {
      public boolean accept(File pathname) 
      {
        return true;
      }
    };
  }
  
  public String getExcels() 
  {
    StringBuffer buf = new StringBuffer();
    String dirName = Constants.XLS_FILES_PATH + Constants.DIR_IFRS_ZMENY;
    java.text.DateFormat df = java.text.DateFormat.getDateTimeInstance(java.text.DateFormat.MEDIUM, java.text.DateFormat.MEDIUM);
    File dir = new File(dirName);
    FileFilter ff = getFileFilter("");
    File[] arr = dir.listFiles(ff);
    if(arr != null) {
      for( int i=0; i<arr.length; i++ ) 
      {
        String name = arr[i].getName();
        buf.append("<a target=\"_blank\" href=\"excelservlet/"+name+"?file="+Constants.DIR_IFRS_ZMENY+"|5C" + name + "\">" + name+ "</a>");
        buf.append("&nbsp;" + df.format( new java.util.Date(arr[i].lastModified())) + "<br>"); 
      }
    }
    return buf.toString();
  }

  /**
   * 
   * Container's getter for VwJtSpolecnostpravifrsdetailView1
   */
  public VwJtSpolecnostpravifrsdetailViewImpl getVwJtSpolecnostpravifrsdetailView1()
  {
    return (VwJtSpolecnostpravifrsdetailViewImpl)findViewObject("VwJtSpolecnostpravifrsdetailView1");
  }

  /**
   * 
   * Container's getter for KpCisIfrstyppravidlodetailView1
   */
  public KpCisIfrstyppravidlodetailViewImpl getKpCisIfrstyppravidlodetailView1()
  {
    return (KpCisIfrstyppravidlodetailViewImpl)findViewObject("KpCisIfrstyppravidlodetailView1");
  }

  /**
   * 
   * Container's getter for KpCisMenaView1
   */
  public KpCisMenaViewImpl getKpCisMenaView1()
  {
    return (KpCisMenaViewImpl)findViewObject("KpCisMenaView1");
  }

  /**
   * 
   * Container's getter for VwJtSpolecnostpravifrshistorView1
   */
  public VwJtSpolecnostpravifrshistorViewImpl getVwJtSpolecnostpravifrshistorView1()
  {
    return (VwJtSpolecnostpravifrshistorViewImpl)findViewObject("VwJtSpolecnostpravifrshistorView1");
  }

  /**
   * 
   * Container's getter for ViewJtSpol2
   */
  public ViewJtSpolImpl getViewJtSpol2()
  {
    return (ViewJtSpolImpl)findViewObject("ViewJtSpol2");
  }

  /**
   * 
   * Container's getter for ViewJtSpolUserPrava1
   */
  public ViewJtSpolUserPravaImpl getViewJtSpolUserPrava1()
  {
    return (ViewJtSpolUserPravaImpl)findViewObject("ViewJtSpolUserPrava1");
  }

  /**
   * 
   * Container's getter for VwProtistranaView1
   */
  public VwProtistranaViewImpl getVwProtistranaView1()
  {
    return (VwProtistranaViewImpl)findViewObject("VwProtistranaView1");
  }

  /**
   * 
   * Container's getter for KpCisIfrssegmentView1
   */
  public KpCisIfrssegmentViewImpl getKpCisIfrssegmentView1()
  {
    return (KpCisIfrssegmentViewImpl)findViewObject("KpCisIfrssegmentView1");
  }

  /**
   * 
   * Container's getter for KpCisIfrssubsegmentView1
   */
  public KpCisIfrssubsegmentViewImpl getKpCisIfrssubsegmentView1()
  {
    return (KpCisIfrssubsegmentViewImpl)findViewObject("KpCisIfrssubsegmentView1");
  }

  /**
   * 
   * Container's getter for KpCisMngsegmentView1
   */
  public KpCisMngsegmentViewImpl getKpCisMngsegmentView1()
  {
    return (KpCisMngsegmentViewImpl)findViewObject("KpCisMngsegmentView1");
  }

  public void ifrsSegment(String akce,
                          int id,
                          String popis) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_CIS_IFRSSEGMENT (S_POPIS) VALUES (?)",0);
        st.setString(1, popis);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury ifrsSegment akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_CIS_IFRSSEGMENT "+
                                            "SET S_POPIS=? "+
                                            "WHERE ID=?",0);
        st.setString(1, popis);
        st.setInt(2, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury ifrsSegment akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_CIS_IFRSSUBSSEGMENT "+
                                            "WHERE ID_IFRSSEGMENT=?",0);
        st.setInt(1, id);
        st.execute();
        st.close();
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_CIS_IFRSSEGMENT "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury ifrsSegment akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }
  
  public void ifrsSubSegment(String akce,
                             int id,
                             String popis,
                             int idSegment) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_CIS_IFRSSUBSEGMENT (S_POPIS,ID_IFRSSEGMENT) VALUES (?,?)",0);
        st.setString(1, popis);
        st.setInt(2, idSegment);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury ifrsSubSegment akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_CIS_IFRSSUBSEGMENT "+
                                            "SET S_POPIS=?, ID_IFRSSEGMENT=? "+
                                            "WHERE ID=?",0);
        st.setString(1, popis);
        st.setInt(2, idSegment);
        st.setInt(3, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury ifrsSubSegment akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_CIS_IFRSSUBSEGMENT "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury ifrsSubSegment akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void mngSegment(String akce,
                         int id,
                         String popis) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_CIS_MNGSEGMENT (S_POPIS) VALUES (?)",0);
        st.setString(1, popis);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury mngSegment akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_CIS_MNGSEGMENT "+
                                            "SET S_POPIS=? "+
                                            "WHERE ID=?",0);
        st.setString(1, popis);
        st.setInt(2, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury mngSegment akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_CIS_MNGSEGMENT "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury mngSegment akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  public void mngSegmentBoss(String akce,
                             int id,
                             int idMngSeg,
                             int idBoss,
                             int idTop,
                             int idSponzor,
                             java.sql.Date dtOd,
                             java.sql.Date dtDo) throws KisException
  {
    DBTransaction dbTran = this.getDBTransaction();
    PreparedStatement st = null;

    //INSERT
    if("I".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("INSERT INTO DB_JT.KP_DAT_MNGSEGMENTBOSS (ID_MNGSEGMENT, ID_BOSS, ID_TOPMNG, ID_SPONZOR, DT_PLATNOSTOD, DT_PLATNOSTDO) VALUES (?,?,?,?,?,?)",0);
        st.setInt(1, idMngSeg);
        st.setInt(2, idBoss);
        st.setInt(3, idTop);
        st.setInt(4, idSponzor);
        st.setDate(5, dtOd);
        st.setDate(6, dtDo);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury mngSegmentBoss akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //UPDATE
    else if("U".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("UPDATE DB_JT.KP_DAT_MNGSEGMENTBOSS "+
                                            "SET ID_MNGSEGMENT=?, ID_BOSS=?, ID_TOPMNG=?, ID_SPONZOR=?, DT_PLATNOSTOD=?, DT_PLATNOSTDO=? "+
                                            "WHERE ID=?",0);
        st.setInt(1, idMngSeg);
        st.setInt(2, idBoss);
        st.setInt(3, idTop);
        st.setInt(4, idSponzor);
        st.setDate(5, dtOd);
        st.setDate(6, dtDo);
        st.setInt(7, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury mngSegmentBoss akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    //DELETE
    else if("D".equals(akce)) {
      try {
        st = dbTran.createPreparedStatement("DELETE FROM DB_JT.KP_DAT_MNGSEGMENTBOSS "+
                                            "WHERE ID=?",0);
        st.setInt(1, id);
        st.execute();
      }
      catch (SQLException s) {
        s.printStackTrace(); //pro zacatek
        throw new KisException("Selhalo volání procedury mngSegmentBoss akce="+akce,s);
      }
      finally {
        try {
          if (st != null) st.close();
        } 
        catch (SQLException s) { /* ignore */}
      }
    }
    
    dbTran.commit();
  }

  /**
   * 
   * Container's getter for KpDatMngsegmentbossView1
   */
  public KpDatMngsegmentbossViewImpl getKpDatMngsegmentbossView1()
  {
    return (KpDatMngsegmentbossViewImpl)findViewObject("KpDatMngsegmentbossView1");
  }

  /**
   * 
   * Container's getter for KtgAppuserView1
   */
  public KtgAppuserViewImpl getKtgAppuserView1()
  {
    return (KtgAppuserViewImpl)findViewObject("KtgAppuserView1");
  }

  /**
   * 
   * Container's getter for VwKtgProjektView1
   */
  public VwKtgProjektViewImpl getVwKtgProjektView1()
  {
    return (VwKtgProjektViewImpl)findViewObject("VwKtgProjektView1");
  }

  /**
   * 
   * Container's getter for KpKtgProjektView1
   */
  public KpKtgProjektViewImpl getKpKtgProjektView1()
  {
    return (KpKtgProjektViewImpl)findViewObject("KpKtgProjektView1");
  }

  /**
   * 
   * Container's getter for KpKtgUcetnispolecnostView1
   */
  public KpKtgUcetnispolecnostViewImpl getKpKtgUcetnispolecnostView1()
  {
    return (KpKtgUcetnispolecnostViewImpl)findViewObject("KpKtgUcetnispolecnostView1");
  }

  /**
   * 
   * Container's getter for VwKtgUcetnispolecnostView1
   */
  public VwKtgUcetnispolecnostViewImpl getVwKtgUcetnispolecnostView1()
  {
    return (VwKtgUcetnispolecnostViewImpl)findViewObject("VwKtgUcetnispolecnostView1");
  }

  /**
   * 
   * Container's getter for KpKtgOdborView1
   */
  public KpKtgOdborViewImpl getKpKtgOdborView1()
  {
    return (KpKtgOdborViewImpl)findViewObject("KpKtgOdborView1");
  }

  /**
   * 
   * Container's getter for VwKtgOdborView1
   */
  public VwKtgOdborViewImpl getVwKtgOdborView1()
  {
    return (VwKtgOdborViewImpl)findViewObject("VwKtgOdborView1");
  }

  /**
   * 
   * Container's getter for KpRelProjektucspolView1
   */
  public KpRelProjektucspolViewImpl getKpRelProjektucspolView1()
  {
    return (KpRelProjektucspolViewImpl)findViewObject("KpRelProjektucspolView1");
  }

  /**
   * 
   * Container's getter for VwKpMajetkovaucastprehledView1
   */
  public VwKpMajetkovaucastprehledViewImpl getVwKpMajetkovaucastprehledView1()
  {
    return (VwKpMajetkovaucastprehledViewImpl)findViewObject("VwKpMajetkovaucastprehledView1");
  }

  public void segmentZastup(String akce,
                     int id,
                     int kdo,
                     java.sql.Date dtOd,
                     java.sql.Date dtDo,
                     int koho,
                     String fwdEmail,
                     int typ) throws KisException
  {
    int idKoho = koho<1 ? currentUsersId() : koho;

    DBTransaction dbTran = this.getDBTransaction();
    CallableStatement st = null;
    try {
      if("I".equals(akce)) {
        st = dbTran.createCallableStatement("INSERT INTO DB_JT.KP_DAT_SEGMENTZASTUP (ID_KOHO, ID_KDO, DT_PLATNOSTOD, DT_PLATNOSTDO, C_FWDEMAIL, NL_TYP) VALUES (?,?,?,?,?,?)",0);
        st.setInt(1,idKoho);
        st.setInt(2,kdo);
        st.setDate(3,dtOd);
        st.setDate(4,dtDo);
        st.setString(5,fwdEmail);
        st.setInt(6,typ);
        st.execute();
      }
      else if("U".equals(akce)) {
        st = dbTran.createCallableStatement("UPDATE DB_JT.KP_DAT_SEGMENTZASTUP SET ID_KOHO=?, ID_KDO=?, DT_PLATNOSTOD=?, DT_PLATNOSTDO=?, C_FWDEMAIL=?, NL_TYP=? WHERE ID=?",0);
        st.setInt(1,idKoho);
        st.setInt(2,kdo);
        st.setDate(3,dtOd);
        st.setDate(4,dtDo);
        st.setString(5,fwdEmail);
        st.setInt(6,typ);
        st.setInt(7,id);
        st.execute();
      }
      else if("D".equals(akce)) {
        st = dbTran.createCallableStatement("DELETE FROM DB_JT.KP_DAT_SEGMENTZASTUP WHERE ID=?",0);
        st.setInt(1,id);
        st.execute();
      }
    }
    catch (SQLException s) {
      s.printStackTrace(); //pro zacatek
      throw new KisException("Selhalo volání java procedury zastup()",s);
    }
    finally {
      try {
        if (st != null) st.close();
      } 
      catch (SQLException s) { /* ignore */}
    }
    dbTran.commit();
  }

  /**
   * 
   * Container's getter for KpDatSegmentzastupView1
   */
  public KpDatSegmentzastupViewImpl getKpDatSegmentzastupView1()
  {
    return (KpDatSegmentzastupViewImpl)findViewObject("KpDatSegmentzastupView1");
  }

  /**
   * 
   * Container's getter for KpCisSegmentzastuptypView1
   */
  public KpCisSegmentzastuptypViewImpl getKpCisSegmentzastuptypView1()
  {
    return (KpCisSegmentzastuptypViewImpl)findViewObject("KpCisSegmentzastuptypView1");
  }

  /**
   * 
   * Container's getter for KpKtgUcetnispolecnostLinkView1
   */
  public KpKtgUcetnispolecnostLinkViewImpl getKpKtgUcetnispolecnostLinkView1()
  {
    return (KpKtgUcetnispolecnostLinkViewImpl)findViewObject("KpKtgUcetnispolecnostLinkView1");
  }
}