package cz.jtbank.konsolidace.doklady;
import java.net.*;
import oracle.jbo.server.ViewRowImpl;
import oracle.jbo.server.AttributeDefImpl;
import oracle.jbo.domain.Number;
import oracle.jbo.domain.Date;
import oracle.jbo.domain.RowID;
import java.io.*; //prozatim
import cz.jtbank.konsolidace.common.Constants;
import java.text.*;
import oracle.jbo.Row;
import oracle.jbo.ViewObject;
import cz.jtbank.konsolidace.doklady.common.DokladyModule;
import java.util.*;
//  ---------------------------------------------------------------
//  ---    File generated by Oracle Business Components for Java.
//  ---------------------------------------------------------------

public class ViewJtSpolUserPravaRowImpl extends ViewRowImpl 
{


  protected static final int ID = 0;
  protected static final int SNAZEV = 1;
  protected static final int SSOUBORPREDPONA = 2;
  protected static final int IDCISSUBJECT = 3;
  protected static final int SMENA = 4;
  protected static final int LASTCLOSEDATE = 5;
  protected static final int CAUTOMATICKEGENEROVANI = 6;
  protected static final int CRKC = 7;
  protected static final int SPINID = 8;
  protected static final int TOPASID = 9;
  protected static final int QUESTID = 10;
  protected static final int SDBLINK = 11;
  protected static final int SZKRATKA = 12;
  protected static final int IDKATEGORIE = 13;
  protected static final int IDKTGCISSPOLECNOSTPRAVO = 14;
  protected static final int SUSERID = 15;
  protected static final int ROWID = 16;
  protected static final int DIRBILANCEMAN = 17;
  protected static final int OWNGROUPID = 18;
  protected static final int DIRSKUPINY = 19;
  protected static final int FRONTACLASS = 20;
  protected static final int DIRSKUPINYVSE = 21;
  protected static final int IDKTGPROJEKT = 22;
  protected static final int IDKTGODBOR = 23;
  protected static final int DIRBILANCEMANVSE = 24;
  protected static final int CONLINE = 25;
  protected static final int STDUOSTART = 26;
  protected static final int STDUOKONEC = 27;
  protected static final int IDMNGSEGMENT = 28;
  /**
   * 
   * This is the default constructor (do not remove)
   */
  public ViewJtSpolUserPravaRowImpl()
  {
  }

  /**
   * 
   * Gets VwJtSpolecnostuserpravo entity object.
   */
  public VwJtSpolecnostuserpravoImpl getVwJtSpolecnostuserpravo()
  {
    return (VwJtSpolecnostuserpravoImpl)getEntity(0);
  }

  /**
   * 
   * Gets the attribute value for ID using the alias name Id
   */
  public Number getId()
  {
    return (Number)getAttributeInternal(ID);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID using the alias name Id
   */
  public void setId(Number value)
  {
    setAttributeInternal(ID, value);
  }

  /**
   * 
   * Gets the attribute value for S_NAZEV using the alias name SNazev
   */
  public String getSNazev()
  {
    String ret = (String)getAttributeInternal(SNAZEV);
    
    if(!"1".equals(getStdUostart()) || !"1".equals(getStdUokonec())) {
      ret = "<font color='brown'>" + ret + "</font>";
      if("0".equals(getCOnline())) ret += " <font color='gray'>OFF-LINE</font>";
    }
    else if("0".equals(getCOnline())) ret = "<font color='gray'>" + ret + "</font>";
    
    return ret;
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for S_NAZEV using the alias name SNazev
   */
  public void setSNazev(String value)
  {
    setAttributeInternal(SNAZEV, value);
  }

  /**
   * 
   * Gets the attribute value for S_SOUBORPREDPONA using the alias name SSouborpredpona
   */
  public String getSSouborpredpona()
  {
    return (String)getAttributeInternal(SSOUBORPREDPONA);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for S_SOUBORPREDPONA using the alias name SSouborpredpona
   */
  public void setSSouborpredpona(String value)
  {
    setAttributeInternal(SSOUBORPREDPONA, value);
  }

  /**
   * 
   * Gets the attribute value for ID_CISSUBJECT using the alias name IdCissubject
   */
  public Number getIdCissubject()
  {
    return (Number)getAttributeInternal(IDCISSUBJECT);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_CISSUBJECT using the alias name IdCissubject
   */
  public void setIdCissubject(Number value)
  {
    setAttributeInternal(IDCISSUBJECT, value);
  }

  /**
   * 
   * Gets the attribute value for S_MENA using the alias name SMena
   */
  public String getSMena()
  {
    return (String)getAttributeInternal(SMENA);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for S_MENA using the alias name SMena
   */
  public void setSMena(String value)
  {
    setAttributeInternal(SMENA, value);
  }

  /**
   * 
   * Gets the attribute value for LASTCLOSEDATE using the alias name Lastclosedate
   */
  public Date getLastclosedate()
  {
    return (Date)getAttributeInternal(LASTCLOSEDATE);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for LASTCLOSEDATE using the alias name Lastclosedate
   */
  public void setLastclosedate(Date value)
  {
    setAttributeInternal(LASTCLOSEDATE, value);
  }

  /**
   * 
   * Gets the attribute value for C_AUTOMATICKEGENEROVANI using the alias name CAutomatickegenerovani
   */
  public String getCAutomatickegenerovani()
  {
    return (String)getAttributeInternal(CAUTOMATICKEGENEROVANI);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for C_AUTOMATICKEGENEROVANI using the alias name CAutomatickegenerovani
   */
  public void setCAutomatickegenerovani(String value)
  {
    setAttributeInternal(CAUTOMATICKEGENEROVANI, value);
  }

  /**
   * 
   * Gets the attribute value for C_RKC using the alias name CRkc
   */
  public String getCRkc()
  {
    return (String)getAttributeInternal(CRKC);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for C_RKC using the alias name CRkc
   */
  public void setCRkc(String value)
  {
    setAttributeInternal(CRKC, value);
  }

  /**
   * 
   * Gets the attribute value for SPIN_ID using the alias name SpinId
   */
  public Number getSpinId()
  {
    return (Number)getAttributeInternal(SPINID);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for SPIN_ID using the alias name SpinId
   */
  public void setSpinId(Number value)
  {
    setAttributeInternal(SPINID, value);
  }

  /**
   * 
   * Gets the attribute value for TOPAS_ID using the alias name TopasId
   */
  public String getTopasId()
  {
    return (String)getAttributeInternal(TOPASID);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for TOPAS_ID using the alias name TopasId
   */
  public void setTopasId(String value)
  {
    setAttributeInternal(TOPASID, value);
  }

  /**
   * 
   * Gets the attribute value for QUEST_ID using the alias name QuestId
   */
  public String getQuestId()
  {
    return (String)getAttributeInternal(QUESTID);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for QUEST_ID using the alias name QuestId
   */
  public void setQuestId(String value)
  {
    setAttributeInternal(QUESTID, value);
  }

  /**
   * 
   * Gets the attribute value for S_DBLINK using the alias name SDblink
   */
  public String getSDblink()
  {
    return (String)getAttributeInternal(SDBLINK);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for S_DBLINK using the alias name SDblink
   */
  public void setSDblink(String value)
  {
    setAttributeInternal(SDBLINK, value);
  }

  /**
   * 
   * Gets the attribute value for S_ZKRATKA using the alias name SZkratka
   */
  public String getSZkratka()
  {
    return (String)getAttributeInternal(SZKRATKA);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for S_ZKRATKA using the alias name SZkratka
   */
  public void setSZkratka(String value)
  {
    setAttributeInternal(SZKRATKA, value);
  }

  /**
   * 
   * Gets the attribute value for ID_KATEGORIE using the alias name IdKategorie
   */
  public Number getIdKategorie()
  {
    return (Number)getAttributeInternal(IDKATEGORIE);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_KATEGORIE using the alias name IdKategorie
   */
  public void setIdKategorie(Number value)
  {
    setAttributeInternal(IDKATEGORIE, value);
  }

  /**
   * 
   * Gets the attribute value for ID_KTGCISSPOLECNOSTPRAVO using the alias name IdKtgcisspolecnostpravo
   */
  public Number getIdKtgcisspolecnostpravo()
  {
    return (Number)getAttributeInternal(IDKTGCISSPOLECNOSTPRAVO);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_KTGCISSPOLECNOSTPRAVO using the alias name IdKtgcisspolecnostpravo
   */
  public void setIdKtgcisspolecnostpravo(Number value)
  {
    setAttributeInternal(IDKTGCISSPOLECNOSTPRAVO, value);
  }

  /**
   * 
   * Gets the attribute value for S_USERID using the alias name SUserid
   */
  public String getSUserid()
  {
    return (String)getAttributeInternal(SUSERID);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for S_USERID using the alias name SUserid
   */
  public void setSUserid(String value)
  {
    setAttributeInternal(SUSERID, value);
  }

  /**
   * 
   * Gets the attribute value for ROWID using the alias name RowID
   */
  public RowID getRowID()
  {
    return (RowID)getAttributeInternal(ROWID);
  }




  /**
   * 
   * Sets <code>value</code> as the attribute value for the calculated attribute DirBilanceMan
   */
  public void setDirBilanceMan(String value)
  {
    setAttributeInternal(DIRBILANCEMAN, value);
  }

  /**
   * 
   * Gets the attribute value for the calculated attribute OwnGroupId
   */
  public String getOwnGroupId()
  {
    return (String)getAttributeInternal(OWNGROUPID);
  }

  /**
   * 
   * Sets <code>value</code> as the attribute value for the calculated attribute OwnGroupId
   */
  public void setOwnGroupId(String value)
  {
    setAttributeInternal(OWNGROUPID, value);
  }
  //  Generated method. Do not modify.

  protected Object getAttrInvokeAccessor(int index, AttributeDefImpl attrDef) throws Exception
  {
    switch (index)
      {
      case ID:
        return getId();
      case SNAZEV:
        return getSNazev();
      case SSOUBORPREDPONA:
        return getSSouborpredpona();
      case IDCISSUBJECT:
        return getIdCissubject();
      case SMENA:
        return getSMena();
      case LASTCLOSEDATE:
        return getLastclosedate();
      case CAUTOMATICKEGENEROVANI:
        return getCAutomatickegenerovani();
      case CRKC:
        return getCRkc();
      case SPINID:
        return getSpinId();
      case TOPASID:
        return getTopasId();
      case QUESTID:
        return getQuestId();
      case SDBLINK:
        return getSDblink();
      case SZKRATKA:
        return getSZkratka();
      case IDKATEGORIE:
        return getIdKategorie();
      case IDKTGCISSPOLECNOSTPRAVO:
        return getIdKtgcisspolecnostpravo();
      case SUSERID:
        return getSUserid();
      case ROWID:
        return getRowID();
      case DIRBILANCEMAN:
        return getDirBilanceMan();
      case OWNGROUPID:
        return getOwnGroupId();
      case DIRSKUPINY:
        return getDirSkupiny();
      case FRONTACLASS:
        return getFrontaClass();
      case DIRSKUPINYVSE:
        return getDirSkupinyVse();
      case IDKTGPROJEKT:
        return getIdKtgprojekt();
      case IDKTGODBOR:
        return getIdKtgodbor();
      case DIRBILANCEMANVSE:
        return getDirBilanceManVse();
      case CONLINE:
        return getCOnline();
      case STDUOSTART:
        return getStdUostart();
      case STDUOKONEC:
        return getStdUokonec();
      case IDMNGSEGMENT:
        return getIdMngsegment();
      default:
        return super.getAttrInvokeAccessor(index, attrDef);
      }
  }
  //  Generated method. Do not modify.

  protected void setAttrInvokeAccessor(int index, Object value, AttributeDefImpl attrDef) throws Exception
  {
    switch (index)
      {
      case CAUTOMATICKEGENEROVANI:
        setCAutomatickegenerovani((String)value);
        return;
      case OWNGROUPID:
        setOwnGroupId((String)value);
        return;
      case IDKTGPROJEKT:
        setIdKtgprojekt((Number)value);
        return;
      case IDKTGODBOR:
        setIdKtgodbor((Number)value);
        return;
      case CONLINE:
        setCOnline((String)value);
        return;
      case STDUOSTART:
        setStdUostart((String)value);
        return;
      case STDUOKONEC:
        setStdUokonec((String)value);
        return;
      case IDMNGSEGMENT:
        setIdMngsegment((Number)value);
        return;
      default:
        super.setAttrInvokeAccessor(index, value, attrDef);
        return;
      }
  }
  
  protected FileFilter getFileFilter(final String name) 
  {
    return new FileFilter() {
      public boolean accept(File pathname) 
      {
        if(pathname.getName().indexOf(name)>-1) return true;
//        if(pathname.getName().startsWith(name)) return true;
        return false;
      }
    };
  }

  private static SimpleDateFormat sdf = new SimpleDateFormat("dd.MM.yyyy");
  private static SimpleDateFormat sdfBack = new SimpleDateFormat("yyyy-MM-dd");
  private static java.text.DateFormat df = java.text.DateFormat.getDateTimeInstance(java.text.DateFormat.MEDIUM, java.text.DateFormat.MEDIUM);
  
  private String getDir(String filter, boolean manFlag)
  {
    String dirName = Constants.XLS_FILES_PATH + getSSouborpredpona() + "_" + getId();
    File dir = new File(dirName);
    StringBuffer buf = new StringBuffer();
    FileFilter ff = getFileFilter(filter);
    File[] arr = dir.listFiles(ff);
    if(arr != null) {
      for( int i=0; i<arr.length; i++ ) 
      {
        int indexMinus = arr[i].getName().indexOf('@');
        String name = indexMinus>-1?arr[i].getName().substring(indexMinus+1):arr[i].getName();
        String idDoklad = indexMinus>-1?arr[i].getName().substring(0,indexMinus):null;

        int dtZac = arr[i].getName().lastIndexOf('_')+1;
        int dtKon = arr[i].getName().lastIndexOf('.');
        String dtDatum = arr[i].getName().substring(dtZac, dtKon);

        boolean dokladExists = false;
        String oo = "", top = "";
        if(idDoklad != null) {
          ViewObject vo = getApplicationModule().findViewObject("KpDatDokladView1");
          vo.clearCache();
          vo.setWhereClause("ID="+idDoklad);
          if(vo.hasNext()) {
            dokladExists = true;
            if(manFlag) 
            {        
              Row row = vo.next();
              Number idKtgDoklad = (Number)row.getAttribute("IdKtgdoklad");
              java.sql.Date dateDt = ((oracle.jbo.domain.Date)row.getAttribute("DtDatum")).dateValue();
              buf.append("<a href=\"DokladyDelete.jsp?dir="+getSSouborpredpona() + "_" + getId()+"&datum="+dtDatum+"\" title=\"Smazat\">DEL</a>\n");
              String href = "DokladyManDef.jsp?idDoklad="+idDoklad+
                                             "&idSpol="+getId()+
                                             "&orgType="+idKtgDoklad.intValue()+
                                             "&genDate="+sdf.format(dateDt)+
                                             "&group="+getOwnGroupId();
              buf.append("<input type=\"button\" onClick=\"javascript:location.replace('"+href+"')\" value=\"Editovat definici\">&nbsp;");
            }
          }
          vo.closeRowSet();
        }
        /*
        if(dokladExists) 
        {
          int typByName = getTypByName( name );
          oo = ((DokladyModule)getApplicationModule()).getZamekCheckbox(Integer.parseInt(idDoklad),getId().intValue(),typByName,Constants.OO);
          buf.append(oo);
          top = ((DokladyModule)getApplicationModule()).getZamekCheckbox(Integer.parseInt(idDoklad),getId().intValue(),typByName,Constants.TOP);
          buf.append(top);
        }
        */
        buf.append("<a target=\"_blank\" href=\"excelservlet/"+arr[i].getName()+"?file=" + getSSouborpredpona() + "_" + getId() + "|5C" + arr[i].getName() + "\">" + name+ "</a>");
        buf.append("&nbsp;" + df.format( new java.util.Date(arr[i].lastModified())) + "&nbsp;"); 
        if(idDoklad != null) {
          buf.append("<a href=\"LogsDokladDetail.jsp?idDoklad="+idDoklad+"\">Logs</a>");
        }
        if(dokladExists) {
          if(name.startsWith("Bilance")) {
            buf.append("&nbsp;<a href=\"Bilance.jsp?idDoklad="+idDoklad+"\" title=\"Zatím jen detail\">D</a>");
          }
          else {
            int skup = getVazbySkupina(name);
            buf.append("&nbsp;<a href=\"DokladVazbyParovani2.jsp?idDoklad="+idDoklad+"&idSkup="+skup+"\" title=\"Párování nespárovaných vazeb\">P</a>");
            //buf.append(" <a href=\"DokladVazbyParovani.jsp?idDoklad="+idDoklad+"&idSkup="+skup+"\" title=\"Párování nespárovaných vazeb - stará verze\" style='font-size:6pt'>POld</a>");
          }
        } 
        buf.append("<br>\n");
      }
    }
    if(buf.length()==0) return null;
    return buf.toString();
  }




  boolean manFlag = false;
  public String getDirBilanceMan()
  {
    manFlag = true;
    return getDirSkupiny();
  }
  
  private int getVazbySkupina(String name) 
  {
    if(name.startsWith("Vazby")) 
    {
      int pos = name.indexOf("Skup");
      if(pos<0) return -1;
      char c = name.charAt(pos+4);
      return Integer.parseInt(""+c);
    }
    return -1;
  }

  private String getStyleLink(String name, String dirHtml) 
  {
    String style = (dirHtml!=null && dirHtml.length()>0) ? "color: orange" : "";
    if(name.indexOf("Mis")>-1) return "style='color: green'";
    if(name.startsWith("Bilance-") ||
       name.startsWith("BilanceIFRS-")) 
    {
      return "style='background-color: #CFFFCF;"+style+"'";
    }
    if(name.startsWith("Vazby_") ||
       name.startsWith("Bilance_") ||
       name.startsWith("Bilance-") ||
       name.startsWith("BilanceIFRS_") ||
       name.startsWith("BilanceIFRS-") ||
       name.startsWith("BilanceDetail") ||
       name.startsWith("BilanceIFRSDetail")
       ) 
    {
      return "style='"+style+"'";
    }
    else {
      return "style='background-color: #FFFFAF;"+style+"'";
    }
  }
  
  private int getTypByName(String name) 
  {
/*
    if(name.startsWith("Bilance_")) 
    {
      return 1;
    }
    if(name.startsWith("BilanceIFRS_")) 
    {
      return 2;
    }
*/    
    if(name.startsWith("Bilance")) 
    {
      return 2;
    }
    if(name.startsWith("Vazby_Skup")) 
    {
      return 49 + getVazbySkupina(name);
    }
    return 0;
  }

  private Comparator c = new Comparator() 
  {
    public int compare(Object obj1, Object obj2) 
    {
      Object[] o1 = (Object[]) obj1;
      Object[] o2 = (Object[]) obj2;
      String dir1 = ( o1[1]!=null && ((String)o1[1]).length()>0 ) ? "ZZZ" : "";
      String dir2 = ( o2[1]!=null && ((String)o2[1]).length()>0 ) ? "ZZZ" : "";
      String t1 = dir1 + ((File) o1[0]).getName();
      String t2 = dir2 + ((File) o2[0]).getName();
      return t1.compareTo(t2);
    }
  };

  private Comparator reverzne = new Comparator() 
  {
    public int compare(Object obj1, Object obj2) 
    {
      String str1 = (String) obj1;
      String str2 = (String) obj2;
      return -1 * str1.compareTo(str2);
    }
  };

  private String curYear = ""+Calendar.getInstance().get(Calendar.YEAR);

  private Map addSoubor(Map map, File soubor, String dir) 
  {
    if(map == null) map = new TreeMap(reverzne);
    
    int dtZac = soubor.getName().lastIndexOf('_')+1;
    int dtKon = soubor.getName().lastIndexOf('.');
    String key = soubor.getName().substring(dtZac, dtKon);
    
    Object[] value = new Object[] { soubor, dir };
    
    if(jenAktualni && !manFlag) {
      getCurrentGenDate();
      if(!key.equals(dttr)) 
      {
        return map;
      }
    }
    else if(jenAktualni && manFlag) {
      if(!key.startsWith(curYear)) 
      {
        return map;
      }
    }
    
    if(map.containsKey(key)) 
    {
      Set val = (Set) map.get(key);
      val.add(value);
    }
    else 
    {
      Set val = new TreeSet(c);
      val.add(value);
      map.put(key, val);
    }
    
    return map;
  }
  
  private Set setDoklady = null;//new HashSet();

  private static FileFilter ff = new FileFilter() {
      public boolean accept(File pathname) 
      {
        //if(pathname.getName().indexOf("_")>-1) return true;
        if(pathname.getName().indexOf("Bilance")>-1 ||
           pathname.getName().indexOf("Vazby")>-1) return true;
        if(pathname.isDirectory()) return true;
        return false;
      }
    };

  /**
   * 
   * Gets the attribute value for the calculated attribute DirSkupiny
   */
  public String getDirSkupiny()
  {
    jenAktualni = true;
    return dirSkupinyToTable();
  }

  private String dttr = null;

  private String getCurrentGenDate() 
  {
    if(dttr != null) return dttr;
    
    if(dokladyModule==null) dokladyModule = (DokladyModule)getApplicationModule();
    ViewObject voDate = dokladyModule.findViewObject("KpParametryView1");
    voDate.clearCache();
    if(voDate.hasNext()) 
    {
      Row row = voDate.next();
      oracle.jbo.domain.Date hlp = (oracle.jbo.domain.Date) row.getAttribute("DtGenerovani");
      if(hlp!=null) 
      {
        dttr = sdfBack.format(hlp.dateValue());
      }
    }
    voDate.closeRowSet();
    
    return dttr;
  }
  
  private boolean jenAktualni;

  private Map addDir(Map soubory, File dir) 
  {
    File[] arr = dir.listFiles(ff);
    if(arr != null) {
      for( int i=0; i<arr.length; i++ ) 
      {
        soubory = addSoubor(soubory, arr[i], dir.getName()+"|5C");
      }
    }
    
    return soubory;
  }

  private String dirSkupinyToTable() 
  {
    Map soubory = null;
    String dirName = Constants.XLS_FILES_PATH + getSSouborpredpona() + "_" + getId();
    File dir = new File(dirName);
    StringBuffer buf = new StringBuffer();
    File[] arr = dir.listFiles(ff);
    if(arr != null) {
      for( int i=0; i<arr.length; i++ ) 
      {
        if(arr[i].isDirectory()) 
        {
          if(dokladyModule==null) dokladyModule = (DokladyModule)getApplicationModule();
          String userName = cz.jtbank.konsolidace.common.Utils.getUserName(dokladyModule, true);
          if(userName!=null && arr[i].getName().equals(userName))
            soubory = addDir(soubory, arr[i]);
        }
        else {
          soubory = addSoubor(soubory, arr[i],"");
        }
      }
    }
    
    if(dokladyModule==null) dokladyModule = (DokladyModule)getApplicationModule();
    setDoklady = dokladyModule.getSetDoklady(getIdKategorie());
    
    if(soubory != null) 
    {
      buf.append("<table width='100%'>");
      Set keys = soubory.keySet();
      Iterator keyIter = keys.iterator();
      while(keyIter.hasNext()) 
      {
        String key = (String)keyIter.next();
        Set vals = (Set) soubory.get(key);
        String html = getHtml(key,vals);
        if(html != null)
          buf.append(html);
      }
      buf.append("</table>");
    }
/*
    if(jenAktualni && !manFlag) {
      buf.append("<div class='clsNextDates'><a href=\"Doklady.jsp?idSpol="+getId()+(manFlag?"&manFlag=true":"")+"\">Doklady pro všechna data</a></div>");
    }
    else if(jenAktualni && manFlag) {
      buf.append("<div class='clsNextDates'><a href=\"DokladyManStarsi.jsp?idSpol="+getId()+"&group="+getOwnGroupId()+"\">Doklady nejen pro aktuální rok</a></div>");
    }
*/    
    if(buf.length()==0) return null;
    return buf.toString();
  }

  private DokladyModule dokladyModule = null;
  
  private String getHtml(String dtDatum, Set soubory) 
  {
    if(soubory==null || soubory.isEmpty()) return null;

    if(dokladyModule==null) dokladyModule = (DokladyModule)getApplicationModule();
    
    String reformDate = "";
    try 
    {
      reformDate = sdf.format( sdfBack.parse(dtDatum) );
    }
    catch(java.text.ParseException pe) {}

    StringBuffer buf = new StringBuffer();    
    String checkboxy;
    buf.append("<tr><td>");
    checkboxy = dokladyModule.getZamekCheckboxy(getId().intValue(), dtDatum);
    buf.append(checkboxy);
    if(checkboxy==null || checkboxy.indexOf("checked")<0) {
      buf.append("<a href=\"DokladyDelete.jsp?dir="+getSSouborpredpona() + "_" + getId()+"&datum="+dtDatum+"\" title=\"Smazat\">DEL</a>\n");
    }
    if(dokladyModule.isCurrentUserType(-666)) {
      buf.append("<br><a href=\"DokladyDelete.jsp?dir="+getSSouborpredpona() + "_" + getId()+"&datum="+dtDatum+"&filter=-PS\" title=\"Smazat počáteční bilance\">DEL-PS</a>\n");
    }
    buf.append("</td><td>");
    Iterator iter = soubory.iterator();
    while(iter.hasNext()) 
    {
      Object[] value = (Object[]) iter.next();
      File soubor = (File) value[0];
      String dirHtml = (String) value[1];
      int indexMinus = soubor.getName().indexOf('@');
      String name = indexMinus>-1 ? soubor.getName().substring(indexMinus+1) : soubor.getName();
      String idDoklad = indexMinus>-1 ? soubor.getName().substring(0,indexMinus) : null;

      boolean dokladExists = false;
      if(idDoklad != null) {
        if ( setDoklady!=null && setDoklady.contains(idDoklad) ) {
          dokladExists = true;
        } /*else {
          dokladExists = dokladyModule.existsDoklad(Integer.parseInt(idDoklad));
          if ( dokladExists ) 
            setDoklady.add(idDoklad);
        }*/
        if(manFlag && (name.startsWith("Bilance_") || name.startsWith("BilanceSub_"))) 
        {        
          ViewObject vo = getApplicationModule().findViewObject("KpDatDokladView1");
          vo.clearCache();
          vo.setWhereClause("ID="+idDoklad);
          if(vo.hasNext()) {
            Row row = vo.next();
            Number idKtgDoklad = (Number)row.getAttribute("IdKtgdoklad");
            String href = "DokladyManDef.jsp?idDoklad="+idDoklad+
                                         "&idSpol="+getId()+
                                         "&orgType="+idKtgDoklad.intValue()+
                                         "&genDate="+reformDate+
                                         "&group="+getOwnGroupId();
            buf.append("<input type=\"button\" onClick=\"javascript:location.replace('"+href+"')\" value=\"Editovat definici\"><br>\n");
          }
          vo.closeRowSet();
        }
        if(manFlag && (name.startsWith("Bilance_") || name.startsWith("BilanceIFRS_"))) 
        {        
          ViewObject vo = getApplicationModule().findViewObject("KpDatDokladView1");
          vo.clearCache();
          vo.setWhereClause("ID="+idDoklad);
          if(vo.hasNext()) {
            buf.append("<input type=\"radio\" name=\"idDoklad\" value=\""+idDoklad+"\">");
          }
          vo.closeRowSet();
        }
      }

      String styleLink = getStyleLink(name,dirHtml);
      buf.append("<a target=\"_blank\" href=\"excelservlet/"+soubor.getName()+"?file=" + getSSouborpredpona() + "_" + getId() + "|5C" + dirHtml + soubor.getName() + "\" "+styleLink+">" + name+ "</a>");
      buf.append("&nbsp;" + df.format( new java.util.Date(soubor.lastModified())) + "&nbsp;"); 
      if(dokladExists) {
        buf.append("<a href=\"LogsDokladDetail.jsp?idDoklad="+idDoklad+"\">Logs</a>");
        if(name.startsWith("Bilance") && name.indexOf("Detail")<0) {
          buf.append("&nbsp;<a href=\"Bilance.jsp?idDoklad="+idDoklad+"\" title=\"Zatím jen detail\">D</a>");
          buf.append("&nbsp;<a href=\"DokladMPOPExport.jsp?idDoklad="+idDoklad+"\" target='_blank' title=\"Export listu MPOP\">MPOP</a>");
          buf.append("&nbsp;<a href=\"KamilPrehledRozklad.jsp?idDoklad="+idDoklad+"\" title=\"Zjednodušená bilance (Kamil)\">K</a>");
          buf.append("&nbsp;<a href=\"MilosPrehledRozklad.jsp?idDoklad="+idDoklad+"\" title=\"Zjednodušená podnikatelská bilance (Miloš)\">M</a>");
          if(styleLink.length()>0 && name.indexOf("IFRS")<0) 
          {
            if(!manFlag) buf.append("&nbsp;<a href=\"DokladyGenSub.jsp?idDoklad="+idDoklad+"\" title=\"Přegenerovat\">G</a>");
            if(getIdKtgodbor()==null && getIdKtgprojekt()==null && name.indexOf("Sub")<0/* && name.indexOf("2005")>0*/) {
              buf.append("&nbsp;<a href=\"DokladManProjektOdbor2.jsp?idDoklad="+idDoklad+"\" title=\"Víceprojektové/odborové počáteční stavy\">PS</a>");
            }
          }
        }
        else if(name.indexOf("Detail")<0) {
          int skup = getVazbySkupina(name);
          buf.append("&nbsp;<a href=\"DokladVazbyParovani2.jsp?idDoklad="+idDoklad+"&idSkup="+skup+"\" title=\"Párování nespárovaných vazeb\">P</a>");
          //buf.append(" <a href=\"DokladVazbyParovani.jsp?idDoklad="+idDoklad+"&idSkup="+skup+"\" title=\"Párování nespárovaných vazeb - stará verze\" style='font-size:6pt'>POld</a>");
        }
      } 
      else 
      {
        buf.append("<a href=\"FileDeleteOwn.jsp?file=data|5C" + getSSouborpredpona() + "_" + getId() + "|5C" + dirHtml + soubor.getName() + "\" title=\"Smazat excel bez dokladu.\">Del</a>");
      }
      buf.append("<br>\n");
    }
    buf.append("</td></tr>");
    
    return buf.toString();
  }

  /**
   * 
   * Sets <code>value</code> as the attribute value for the calculated attribute DirSkupiny
   */
  public void setDirSkupiny(String value)
  {
    setAttributeInternal(DIRSKUPINY, value);
  }

  /**
   * 
   * Gets the attribute value for the calculated attribute FrontaClass
   */
  public String getFrontaClass()
  {
    String ret = "frontaWhite";
    
    ViewObject vo = getApplicationModule().findViewObject("VwKpDokladfrontaView1");
    vo.clearCache();
    vo.setWhereClause("IDSPOLECNOST = "+getId());
    while(vo.hasNext()) 
    {
      Row row = vo.next();
      String stav = (String) row.getAttribute("SStav");
      if(stav!=null) {
        if(stav.startsWith("Gen")) ret = "frontaGreen";
        if(stav.startsWith("Exp")) ret = "frontaGreen";
        if(stav.startsWith("Ček")) ret = "frontaYellow";
        if(stav.startsWith("DB")) ret = "frontaRed";
      }
    }
    vo.closeRowSet();
    
    return ret;
  }

  /**
   * 
   * Sets <code>value</code> as the attribute value for the calculated attribute FrontaClass
   */
  public void setFrontaClass(String value)
  {
    setAttributeInternal(FRONTACLASS, value);
  }
  
  public static void main(String[] argv) 
  {
    ViewJtSpolUserPravaRowImpl o = new ViewJtSpolUserPravaRowImpl();
    System.out.println( o.getVazbySkupina("Vazby10001_Skup2_...") );
  }

  /**
   * 
   * Gets the attribute value for the calculated attribute DirSkupinyVse
   */
  public String getDirSkupinyVse()
  {
    jenAktualni = false;
    return dirSkupinyToTable();
  }

  /**
   * 
   * Sets <code>value</code> as the attribute value for the calculated attribute DirSkupinyVse
   */
  public void setDirSkupinyVse(String value)
  {
    setAttributeInternal(DIRSKUPINYVSE, value);
  }

  /**
   * 
   * Gets the attribute value for ID_KTGPROJEKT using the alias name IdKtgprojekt
   */
  public Number getIdKtgprojekt()
  {
    return (Number)getAttributeInternal(IDKTGPROJEKT);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_KTGPROJEKT using the alias name IdKtgprojekt
   */
  public void setIdKtgprojekt(Number value)
  {
    setAttributeInternal(IDKTGPROJEKT, value);
  }

  /**
   * 
   * Gets the attribute value for ID_KTGODBOR using the alias name IdKtgodbor
   */
  public Number getIdKtgodbor()
  {
    return (Number)getAttributeInternal(IDKTGODBOR);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_KTGODBOR using the alias name IdKtgodbor
   */
  public void setIdKtgodbor(Number value)
  {
    setAttributeInternal(IDKTGODBOR, value);
  }

  /**
   * 
   * Gets the attribute value for the calculated attribute DirBilanceManVse
   */
  public String getDirBilanceManVse()
  {
    manFlag = true;
    return getDirSkupinyVse();
  }

  /**
   * 
   * Sets <code>value</code> as the attribute value for the calculated attribute DirBilanceManVse
   */
  public void setDirBilanceManVse(String value)
  {
    setAttributeInternal(DIRBILANCEMANVSE, value);
  }

  /**
   * 
   * Gets the attribute value for C_ONLINE using the alias name COnline
   */
  public String getCOnline()
  {
    return (String)getAttributeInternal(CONLINE);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for C_ONLINE using the alias name COnline
   */
  public void setCOnline(String value)
  {
    setAttributeInternal(CONLINE, value);
  }

  /**
   * 
   * Gets the attribute value for STD_UOSTART using the alias name StdUostart
   */
  public String getStdUostart()
  {
    return (String)getAttributeInternal(STDUOSTART);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for STD_UOSTART using the alias name StdUostart
   */
  public void setStdUostart(String value)
  {
    setAttributeInternal(STDUOSTART, value);
  }

  /**
   * 
   * Gets the attribute value for STD_UOKONEC using the alias name StdUokonec
   */
  public String getStdUokonec()
  {
    return (String)getAttributeInternal(STDUOKONEC);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for STD_UOKONEC using the alias name StdUokonec
   */
  public void setStdUokonec(String value)
  {
    setAttributeInternal(STDUOKONEC, value);
  }

  /**
   * 
   * Gets the attribute value for ID_MNGSEGMENT using the alias name IdMngsegment
   */
  public Number getIdMngsegment()
  {
    return (Number)getAttributeInternal(IDMNGSEGMENT);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_MNGSEGMENT using the alias name IdMngsegment
   */
  public void setIdMngsegment(Number value)
  {
    setAttributeInternal(IDMNGSEGMENT, value);
  }



}