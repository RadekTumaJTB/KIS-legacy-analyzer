package cz.jtbank.konsolidace.doklady;
import oracle.jbo.server.ViewRowImpl;
import oracle.jbo.server.AttributeDefImpl;
import oracle.jbo.domain.Number;
import oracle.jbo.domain.Date;
import oracle.jbo.domain.RowID;

import oracle.jbo.Row;
import oracle.jbo.ViewObject;
import cz.jtbank.konsolidace.doklady.common.DokladyModule;
import java.io.*;
import cz.jtbank.konsolidace.common.Constants;

import org.apache.log4j.*;
import cz.jtbank.konsolidace.common.Logging;

//  ---------------------------------------------------------------
//  ---    File generated by Oracle Business Components for Java.
//  ---------------------------------------------------------------

public class VwJtSpolecnostuserpravoViewRowImpl extends ViewRowImpl 
{
  protected static final int ID = 0;
  protected static final int SNAZEV = 1;
  protected static final int SSOUBORPREDPONA = 2;
  protected static final int IDCISSUBJECT = 3;
  protected static final int SMENA = 4;
  protected static final int LASTCLOSEDATE = 5;
  protected static final int CAUTOMATICKEGENEROVANI = 6;
  protected static final int CRKC = 7;
  protected static final int SPINID = 8;
  protected static final int TOPASID = 9;
  protected static final int QUESTID = 10;
  protected static final int SDBLINK = 11;
  protected static final int SZKRATKA = 12;
  protected static final int IDKATEGORIE = 13;
  protected static final int IDKTGCISSPOLECNOSTPRAVO = 14;
  protected static final int SUSERID = 15;
  protected static final int ROWID = 16;
  protected static final int IDKTGPROJEKT = 17;
  protected static final int IDKTGODBOR = 18;
  protected static final int CONLINE = 19;
  protected static final int STDUOSTART = 20;
  protected static final int STDUOKONEC = 21;
  protected static final int IDMNGSEGMENT = 22;
  protected static final int DIR = 23;
  protected static final int FRONTACLASS = 24;
  protected static final int DIRVSE = 25;
  protected static final int MISENABLED = 26;
  protected static final int IDCISKATSPOL = 27;
  protected static final int ZODPOVEDNAUCETNI = 28;
  protected static final int ODPOVEDNAOSOBA = 29;
  protected static final int ADMINISTRATOR = 30;
  protected static final int TOPMNG = 31;
  protected static final int MNGSEGMENTBOSS = 32;
  protected static final int CPOCITEJMUPOZICI = 33;
  static Logger logger = Logger.getLogger(DokladyModuleImpl.class);
  static { logger.addAppender(Logging.getAppender(Logging.LOG_DEFAULT)); }

  /**
   * 
   * This is the default constructor (do not remove)
   */
  public VwJtSpolecnostuserpravoViewRowImpl()
  {
  }

  /**
   * 
   * Gets VwJtSpolecnostuserpravo entity object.
   */
  public VwJtSpolecnostuserpravoImpl getVwJtSpolecnostuserpravo()
  {
    return (VwJtSpolecnostuserpravoImpl)getEntity(0);
  }

  /**
   * 
   * Gets the attribute value for ID using the alias name Id
   */
  public Number getId()
  {
    return (Number)getAttributeInternal(ID);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID using the alias name Id
   */
  public void setId(Number value)
  {
    setAttributeInternal(ID, value);
  }

  /**
   * 
   * Gets the attribute value for S_NAZEV using the alias name SNazev
   */
  public String getSNazev()
  {
    String ret = (String)getAttributeInternal(SNAZEV);
    
    if(!"1".equals(getStdUostart()) || !"1".equals(getStdUokonec())) {
      ret = "<font color='brown'>" + ret + "</font>";
      if("0".equals(getCOnline())) ret += " <font color='gray'>OFF-LINE</font>";
    }
    else if("0".equals(getCOnline())) ret = "<font color='gray'>" + ret + "</font>";
    
    return ret;
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for S_NAZEV using the alias name SNazev
   */
  public void setSNazev(String value)
  {
    setAttributeInternal(SNAZEV, value);
  }

  /**
   * 
   * Gets the attribute value for S_SOUBORPREDPONA using the alias name SSouborpredpona
   */
  public String getSSouborpredpona()
  {
    return (String)getAttributeInternal(SSOUBORPREDPONA);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for S_SOUBORPREDPONA using the alias name SSouborpredpona
   */
  public void setSSouborpredpona(String value)
  {
    setAttributeInternal(SSOUBORPREDPONA, value);
  }

  /**
   * 
   * Gets the attribute value for ID_CISSUBJECT using the alias name IdCissubject
   */
  public Number getIdCissubject()
  {
    return (Number)getAttributeInternal(IDCISSUBJECT);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_CISSUBJECT using the alias name IdCissubject
   */
  public void setIdCissubject(Number value)
  {
    setAttributeInternal(IDCISSUBJECT, value);
  }

  /**
   * 
   * Gets the attribute value for S_MENA using the alias name SMena
   */
  public String getSMena()
  {
    return (String)getAttributeInternal(SMENA);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for S_MENA using the alias name SMena
   */
  public void setSMena(String value)
  {
    setAttributeInternal(SMENA, value);
  }

  /**
   * 
   * Gets the attribute value for LASTCLOSEDATE using the alias name Lastclosedate
   */
  public Date getLastclosedate()
  {
    return (Date)getAttributeInternal(LASTCLOSEDATE);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for LASTCLOSEDATE using the alias name Lastclosedate
   */
  public void setLastclosedate(Date value)
  {
    setAttributeInternal(LASTCLOSEDATE, value);
  }

  /**
   * 
   * Gets the attribute value for C_AUTOMATICKEGENEROVANI using the alias name CAutomatickegenerovani
   */
  public String getCAutomatickegenerovani()
  {
    return (String)getAttributeInternal(CAUTOMATICKEGENEROVANI);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for C_AUTOMATICKEGENEROVANI using the alias name CAutomatickegenerovani
   */
  public void setCAutomatickegenerovani(String value)
  {
    setAttributeInternal(CAUTOMATICKEGENEROVANI, value);
  }

  /**
   * 
   * Gets the attribute value for C_RKC using the alias name CRkc
   */
  public String getCRkc()
  {
    return (String)getAttributeInternal(CRKC);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for C_RKC using the alias name CRkc
   */
  public void setCRkc(String value)
  {
    setAttributeInternal(CRKC, value);
  }

  /**
   * 
   * Gets the attribute value for SPIN_ID using the alias name SpinId
   */
  public Number getSpinId()
  {
    return (Number)getAttributeInternal(SPINID);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for SPIN_ID using the alias name SpinId
   */
  public void setSpinId(Number value)
  {
    setAttributeInternal(SPINID, value);
  }

  /**
   * 
   * Gets the attribute value for TOPAS_ID using the alias name TopasId
   */
  public String getTopasId()
  {
    return (String)getAttributeInternal(TOPASID);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for TOPAS_ID using the alias name TopasId
   */
  public void setTopasId(String value)
  {
    setAttributeInternal(TOPASID, value);
  }

  /**
   * 
   * Gets the attribute value for QUEST_ID using the alias name QuestId
   */
  public String getQuestId()
  {
    return (String)getAttributeInternal(QUESTID);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for QUEST_ID using the alias name QuestId
   */
  public void setQuestId(String value)
  {
    setAttributeInternal(QUESTID, value);
  }

  /**
   * 
   * Gets the attribute value for S_DBLINK using the alias name SDblink
   */
  public String getSDblink()
  {
    return (String)getAttributeInternal(SDBLINK);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for S_DBLINK using the alias name SDblink
   */
  public void setSDblink(String value)
  {
    setAttributeInternal(SDBLINK, value);
  }

  /**
   * 
   * Gets the attribute value for S_ZKRATKA using the alias name SZkratka
   */
  public String getSZkratka()
  {
    return (String)getAttributeInternal(SZKRATKA);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for S_ZKRATKA using the alias name SZkratka
   */
  public void setSZkratka(String value)
  {
    setAttributeInternal(SZKRATKA, value);
  }

  /**
   * 
   * Gets the attribute value for ID_KATEGORIE using the alias name IdKategorie
   */
  public Number getIdKategorie()
  {
    return (Number)getAttributeInternal(IDKATEGORIE);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_KATEGORIE using the alias name IdKategorie
   */
  public void setIdKategorie(Number value)
  {
    setAttributeInternal(IDKATEGORIE, value);
  }

  /**
   * 
   * Gets the attribute value for ID_KTGCISSPOLECNOSTPRAVO using the alias name IdKtgcisspolecnostpravo
   */
  public Number getIdKtgcisspolecnostpravo()
  {
    return (Number)getAttributeInternal(IDKTGCISSPOLECNOSTPRAVO);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_KTGCISSPOLECNOSTPRAVO using the alias name IdKtgcisspolecnostpravo
   */
  public void setIdKtgcisspolecnostpravo(Number value)
  {
    setAttributeInternal(IDKTGCISSPOLECNOSTPRAVO, value);
  }

  /**
   * 
   * Gets the attribute value for S_USERID using the alias name SUserid
   */
  public String getSUserid()
  {
    return (String)getAttributeInternal(SUSERID);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for S_USERID using the alias name SUserid
   */
  public void setSUserid(String value)
  {
    setAttributeInternal(SUSERID, value);
  }

  /**
   * 
   * Gets the attribute value for ROWID using the alias name RowID
   */
  public RowID getRowID()
  {
    return (RowID)getAttributeInternal(ROWID);
  }

  /**
   * 
   * Gets the attribute value for ID_KTGPROJEKT using the alias name IdKtgprojekt
   */
  public Number getIdKtgprojekt()
  {
    return (Number)getAttributeInternal(IDKTGPROJEKT);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_KTGPROJEKT using the alias name IdKtgprojekt
   */
  public void setIdKtgprojekt(Number value)
  {
    setAttributeInternal(IDKTGPROJEKT, value);
  }

  /**
   * 
   * Gets the attribute value for ID_KTGODBOR using the alias name IdKtgodbor
   */
  public Number getIdKtgodbor()
  {
    return (Number)getAttributeInternal(IDKTGODBOR);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_KTGODBOR using the alias name IdKtgodbor
   */
  public void setIdKtgodbor(Number value)
  {
    setAttributeInternal(IDKTGODBOR, value);
  }

  /**
   * 
   * Gets the attribute value for C_ONLINE using the alias name COnline
   */
  public String getCOnline()
  {
    return (String)getAttributeInternal(CONLINE);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for C_ONLINE using the alias name COnline
   */
  public void setCOnline(String value)
  {
    setAttributeInternal(CONLINE, value);
  }

  /**
   * 
   * Gets the attribute value for STD_UOSTART using the alias name StdUostart
   */
  public String getStdUostart()
  {
    return (String)getAttributeInternal(STDUOSTART);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for STD_UOSTART using the alias name StdUostart
   */
  public void setStdUostart(String value)
  {
    setAttributeInternal(STDUOSTART, value);
  }

  /**
   * 
   * Gets the attribute value for STD_UOKONEC using the alias name StdUokonec
   */
  public String getStdUokonec()
  {
    return (String)getAttributeInternal(STDUOKONEC);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for STD_UOKONEC using the alias name StdUokonec
   */
  public void setStdUokonec(String value)
  {
    setAttributeInternal(STDUOKONEC, value);
  }

  /**
   * 
   * Gets the attribute value for ID_MNGSEGMENT using the alias name IdMngsegment
   */
  public Number getIdMngsegment()
  {
    return (Number)getAttributeInternal(IDMNGSEGMENT);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_MNGSEGMENT using the alias name IdMngsegment
   */
  public void setIdMngsegment(Number value)
  {
    setAttributeInternal(IDMNGSEGMENT, value);
  }

  /**
   * 
   * Gets the attribute value for the calculated attribute Dir
   */
  public String getDir()
  {
    whereDoklad = "ID_KTGUCETNISPOLECNOST = " + getId() +
              "and NL_KROK in (1,2,90) "+
              "and DT_DATUM = (select par.DT_GENEROVANI from db_jt.kp_parametry par)";
    return getDokladyHtml();
  }

  /**
   * 
   * Sets <code>value</code> as the attribute value for the calculated attribute Dir
   */
  public void setDir(String value)
  {
    setAttributeInternal(DIR, value);
  }
  //  Generated method. Do not modify.

  protected Object getAttrInvokeAccessor(int index, AttributeDefImpl attrDef) throws Exception
  {
    switch (index)
      {
      case ID:
        return getId();
      case SNAZEV:
        return getSNazev();
      case SSOUBORPREDPONA:
        return getSSouborpredpona();
      case IDCISSUBJECT:
        return getIdCissubject();
      case SMENA:
        return getSMena();
      case LASTCLOSEDATE:
        return getLastclosedate();
      case CAUTOMATICKEGENEROVANI:
        return getCAutomatickegenerovani();
      case CRKC:
        return getCRkc();
      case SPINID:
        return getSpinId();
      case TOPASID:
        return getTopasId();
      case QUESTID:
        return getQuestId();
      case SDBLINK:
        return getSDblink();
      case SZKRATKA:
        return getSZkratka();
      case IDKATEGORIE:
        return getIdKategorie();
      case IDKTGCISSPOLECNOSTPRAVO:
        return getIdKtgcisspolecnostpravo();
      case SUSERID:
        return getSUserid();
      case ROWID:
        return getRowID();
      case IDKTGPROJEKT:
        return getIdKtgprojekt();
      case IDKTGODBOR:
        return getIdKtgodbor();
      case CONLINE:
        return getCOnline();
      case STDUOSTART:
        return getStdUostart();
      case STDUOKONEC:
        return getStdUokonec();
      case IDMNGSEGMENT:
        return getIdMngsegment();
      case DIR:
        return getDir();
      case FRONTACLASS:
        return getFrontaClass();
      case DIRVSE:
        return getDirVse();
      case MISENABLED:
        return getMisEnabled();
      case IDCISKATSPOL:
        return getIdCiskatspol();
      case ZODPOVEDNAUCETNI:
        return getZodpovednaucetni();
      case ODPOVEDNAOSOBA:
        return getOdpovednaosoba();
      case ADMINISTRATOR:
        return getAdministrator();
      case TOPMNG:
        return getTopmng();
      case MNGSEGMENTBOSS:
        return getMngsegmentboss();
      case CPOCITEJMUPOZICI:
        return getCPocitejmupozici();
      default:
        return super.getAttrInvokeAccessor(index, attrDef);
      }
  }
  //  Generated method. Do not modify.

  protected void setAttrInvokeAccessor(int index, Object value, AttributeDefImpl attrDef) throws Exception
  {
    switch (index)
      {
      case ID:
        setId((Number)value);
        return;
      case SNAZEV:
        setSNazev((String)value);
        return;
      case SSOUBORPREDPONA:
        setSSouborpredpona((String)value);
        return;
      case IDCISSUBJECT:
        setIdCissubject((Number)value);
        return;
      case SMENA:
        setSMena((String)value);
        return;
      case LASTCLOSEDATE:
        setLastclosedate((Date)value);
        return;
      case CAUTOMATICKEGENEROVANI:
        setCAutomatickegenerovani((String)value);
        return;
      case CRKC:
        setCRkc((String)value);
        return;
      case SPINID:
        setSpinId((Number)value);
        return;
      case TOPASID:
        setTopasId((String)value);
        return;
      case QUESTID:
        setQuestId((String)value);
        return;
      case SDBLINK:
        setSDblink((String)value);
        return;
      case SZKRATKA:
        setSZkratka((String)value);
        return;
      case IDKATEGORIE:
        setIdKategorie((Number)value);
        return;
      case IDKTGCISSPOLECNOSTPRAVO:
        setIdKtgcisspolecnostpravo((Number)value);
        return;
      case SUSERID:
        setSUserid((String)value);
        return;
      case IDKTGPROJEKT:
        setIdKtgprojekt((Number)value);
        return;
      case IDKTGODBOR:
        setIdKtgodbor((Number)value);
        return;
      case CONLINE:
        setCOnline((String)value);
        return;
      case STDUOSTART:
        setStdUostart((String)value);
        return;
      case STDUOKONEC:
        setStdUokonec((String)value);
        return;
      case IDMNGSEGMENT:
        setIdMngsegment((Number)value);
        return;
      case MISENABLED:
        setMisEnabled((Boolean)value);
        return;
      case IDCISKATSPOL:
        setIdCiskatspol((Number)value);
        return;
      case ZODPOVEDNAUCETNI:
        setZodpovednaucetni((String)value);
        return;
      case ODPOVEDNAOSOBA:
        setOdpovednaosoba((String)value);
        return;
      case ADMINISTRATOR:
        setAdministrator((String)value);
        return;
      case TOPMNG:
        setTopmng((String)value);
        return;
      case MNGSEGMENTBOSS:
        setMngsegmentboss((String)value);
        return;
      case CPOCITEJMUPOZICI:
        setCPocitejmupozici((String)value);
        return;
      default:
        super.setAttrInvokeAccessor(index, value, attrDef);
        return;
      }
  }
  
  private String whereDoklad = null;
  
  private StringBuffer buf = new StringBuffer();

  private DokladyModule dokladyModule = null;

  private static java.text.DateFormat df = java.text.DateFormat.getDateTimeInstance(java.text.DateFormat.MEDIUM, java.text.DateFormat.MEDIUM);
  private static java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat("dd.MM.yyyy");
  
  private String getDokladyHtml() 
  {
    if(dokladyModule==null) dokladyModule = (DokladyModule)getApplicationModule();
    
    java.sql.Date lastDatum = null;
    
    ViewObject vo = dokladyModule.findViewObject("KpDatDokladView3");
    vo.clearCache();
    vo.setWhereClause(whereDoklad+" AND S_UZIVATEL<>'denni' AND 1=(select kd.id_cisDoklad from db_jt.kp_ktg_doklad kd where kd.id = KpDatDoklad.id_ktgDoklad)");
    vo.setOrderByClause("DT_DATUM DESC, ID_SUBKONSOLIDACE ASC, NL_KROK ASC");
int cnt1 = vo.getRowCount();
vo.clearCache();
int cnt2 = vo.getRowCount();
if(cnt1!=cnt2) logger.error("CLEAR rowCount="+vo.getRowCount()+", QUERY = "+vo.getQuery());
else {
  vo.executeQuery();
  cnt2 = vo.getRowCount();
  if(cnt1!=cnt2) logger.error("EXECUTE rowCount="+vo.getRowCount()+", QUERY = "+vo.getQuery());
}
    while(vo.hasNext()) 
    {
      Row row = vo.next();
      Number idDoklad = (Number) row.getAttribute("Id");
      Number krok = (Number) row.getAttribute("NlKrok");
      java.sql.Date dtDatum = ((oracle.jbo.domain.Date) row.getAttribute("DtDatum")).dateValue();
      String strDatum = sdf.format(dtDatum);
      Number idSub = (Number) row.getAttribute("IdSubkonsolidace");

      boolean sub = !getId().equals(idSub);
      boolean man = getIdKategorie().toString().endsWith("30");
      boolean lokal = "1".equals(krok.toString());
      boolean ifrs = "2".equals(krok.toString());
      boolean mis = "90".equals(krok.toString());
      
      if(!mis || getMisEnabled().booleanValue()) {
        
        if(lastDatum!=null && !lastDatum.equals(dtDatum)) 
        {
          getDokladyHtmlUnif(lastDatum,buf);
          buf.append("<hr>");
        }
        lastDatum = dtDatum;
  
        buf.append("<table width='100%'>");
        buf.append("<tr><td valign='top' align='left' width='50'>");
        if(!sub && !mis) {
          String checkboxy = dokladyModule.getZamekCheckboxy(getId().intValue(), dtDatum, krok.intValue());
          buf.append(checkboxy);
        }
        //predelat na doklady!!!
        //buf.append("<a href=\"DokladyDelete.jsp?dir="+getSSouborpredpona() + "_" + getId()+"&datum="+dtDatum+"\" title=\"Smazat\">DEL</a>\n");
        buf.append("<a href=\"DokladyDelete.jsp?idDoklad="+idDoklad+"\" title=\"Smazat doklad\">DEL</a>\n");
        /*if(dokladyModule.isCurrentUserType(-666)) {
          buf.append("<br><a href=\"DokladyDelete.jsp?dir="+getSSouborpredpona() + "_" + getId()+"&datum="+dtDatum+"&filter=-PS\" title=\"Smazat poèáteèní bilance\">DEL-PS</a>\n");
        }*/
        buf.append("</td><td valign='top' align='left'>");
        
        if(man && !sub) 
        {        
          buf.append("<input type=\"radio\" name=\"idDoklad\" value=\""+idDoklad+"\">");
        }
  
        String txtKrok;
        if("2".equals(krok.toString())) txtKrok = "IFRS";
        else txtKrok = "Lokální";
  
        String styleSub = " style='";
        if(sub) styleSub += "background-color:#FFFFAF;";
        if(mis) styleSub += "color:green;";
        styleSub += "'";
  
        buf.append("<b"+styleSub+">"+txtKrok+"&nbsp;doklad&nbsp;k&nbsp;"+strDatum+"&nbsp;("+idDoklad+(sub?"/"+idSub:"")+")</b>");
        buf.append(" <a href=\"LogsDokladDetail.jsp?idDoklad="+idDoklad+"\">Logs</a>");
        buf.append("&nbsp;<a href=\"Bilance.jsp?idDoklad="+idDoklad+"\" title=\"Zatím jen detail\">D</a>");
        buf.append("&nbsp;<a href=\"DokladMPOPExport.jsp?idDoklad="+idDoklad+"\" target='_blank' title=\"Export listu MPOP\">MPOP</a>");
        buf.append("&nbsp;<a href=\"KamilPrehledRozklad.jsp?idDoklad="+idDoklad+"\" title=\"Zjednodušená bilance (Kamil)\">K</a>");
        buf.append("&nbsp;<a href=\"MilosPrehledRozklad.jsp?idDoklad="+idDoklad+"\" title=\"Zjednodušená podnikatelská bilance (Miloš)\">M</a>");
        if(man && lokal) 
        {
            Number idKtgDoklad = (Number)row.getAttribute("IdKtgdoklad");
            String idKat = getIdKategorie().toString();
            int kategorie = 3;
            if(idKat.startsWith("1")) kategorie = 4;
            else if(idKat.startsWith("2")) kategorie = 5;
            String href = "DokladyManDef.jsp?idDoklad="+idDoklad+
                                         "&idSpol="+getId()+
                                         "&orgType="+idKtgDoklad+
                                         "&genDate="+strDatum+
                                         "&kategorie="+kategorie;
            buf.append("<input type=\"button\" onClick=\"javascript:location.replace('"+href+"')\" value=\"Editovat definici\"><br>\n");
        }
  
        listVazby(idDoklad);
        
        buf.append("<br>");
        listFilesHtml(idDoklad);
        listCSVsHtml(idDoklad);
        buf.append("</td></tr>");
        buf.append("</table>");
      }
      if(!vo.hasNext()) {
        getDokladyHtmlUnif(dtDatum,buf);
      }
    }
    vo.closeRowSet();
  
    if(buf.length()==0) return null;
    
    return buf.toString();
  }
  
  private void getDokladyHtmlUnif(java.sql.Date dtDatum,StringBuffer buf) 
  {
    String dirName = Constants.XLS_FILES_PATH + getSSouborpredpona() + "_" + getId();
    File dir = new File(dirName);
    FileFilter ff = getFileFilterUnif(dtDatum);
    File[] arr = dir.listFiles(ff);
    if(arr != null && arr.length>0) {
      buf.append("<table width='100%'>");
      buf.append("<tr><td valign='top' align='left' width='50'><b>Doklad<br>2007:</b></td>");
      buf.append("<td valign='top' align='left'>");
      for( int i=0; i<arr.length; i++ ) 
      {
        String name = arr[i].getName();
        
        String styleLink = getStyleLink(name);
        buf.append("<a target=\"_blank\" href=\"excelservlet/"+arr[i].getName()+"?file=" + getSSouborpredpona() + "_" + getId() + "|5C" + name + "\" "+styleLink+">" + name+ "</a>");
        buf.append("&nbsp;" + df.format( new java.util.Date(arr[i].lastModified())) + "&nbsp;"); 
        buf.append("<a href=\"LogsDokladDetailUnif.jsp?idSpol="+getId()+"&datum="+dtDatum+"\">Logs</a>");
        buf.append("<br>\n");
      }  
      buf.append("</td></tr>");
      buf.append("</table>");
    }
  }

  protected FileFilter getFileFilter(final Number idDoklad) 
  {
    return new FileFilter() {
      public boolean accept(File pathname) 
      {
        if(pathname.getName().startsWith(idDoklad+"@")) return true;
        return false;
      }
    };
  }

  protected FileFilter getFileFilterUnif(final java.sql.Date dtDatum) 
  {
    return new FileFilter() {
      public boolean accept(File pathname) 
      {
        if(pathname.getName().indexOf("2007")>-1 &&
           pathname.getName().indexOf(dtDatum.toString())>-1 &&
           pathname.getName().indexOf("@")<0) return true;
        return false;
      }
    };
  }

  private void listFilesHtml(Number idDoklad) {
    String dirName = Constants.XLS_FILES_PATH + getSSouborpredpona() + "_" + getId();
    File dir = new File(dirName);
    FileFilter ff = getFileFilter(idDoklad);
    File[] arr = dir.listFiles(ff);
    if(arr != null) {
      for( int i=0; i<arr.length; i++ ) 
      {
        int indexMinus = arr[i].getName().indexOf('@');
        String name = indexMinus>-1?arr[i].getName().substring(indexMinus+1):arr[i].getName();
        
        String styleLink = getStyleLink(name);
        buf.append("<a target=\"_blank\" href=\"excelservlet/"+arr[i].getName()+"?file=" + getSSouborpredpona() + "_" + getId() + "|5C" + arr[i].getName() + "\" "+styleLink+">" + name+ "</a>");
        buf.append("&nbsp;" + df.format( new java.util.Date(arr[i].lastModified())) + "&nbsp;"); 
        if(name.startsWith("Bilance")) {
        }
        buf.append("<br>\n");
      }  
    }
  }

  private void listCSVsHtml(Number idDoklad) {
    String dirName = Constants.CSV_FILES_PATH + getSSouborpredpona() + "_" + getId();
    File dir = new File(dirName);
    FileFilter ff = getFileFilter(idDoklad);
    File[] arr = dir.listFiles(ff);
    if(arr != null) {
      if(arr.length>0) buf.append("<b>CSV:</b><br>");
      for( int i=0; i<arr.length; i++ ) 
      {
        int indexMinus = arr[i].getName().indexOf('@');
        String name = indexMinus>-1?arr[i].getName().substring(indexMinus+1):arr[i].getName();
        
        String styleLink = "";//getStyleLink(name);
        buf.append("<a target=\"_blank\" href=\"filesservlet/"+arr[i].getName()+"?file=csv|5C" + getSSouborpredpona() + "_" + getId() + "|5C" + arr[i].getName() + "\" "+styleLink+">" + name+ "</a>");
        buf.append("&nbsp;" + df.format( new java.util.Date(arr[i].lastModified())) + "&nbsp;"); 
        if(name.startsWith("Bilance")) {
        }
        buf.append("<br>\n");
      }  
    }
  }
  
  private void listVazby(Number idDoklad) {
    if(dokladyModule==null) dokladyModule = (DokladyModule)getApplicationModule();
    ViewObject vo = dokladyModule.findViewObject("KpDatDokladvazbySkupinyView1");
    vo.clearCache();
    vo.setWhereClause("ID_DOKLAD = "+idDoklad);
    vo.setOrderByClause("ID_KTGUCETNISKUPINA ASC");
    if(vo.hasNext()) 
    {
      buf.append("<br><b>Párování&nbsp;VV&nbsp;skupiny:</b>");
    }
    boolean first = true;
    while(vo.hasNext()) 
    {
      Row row = vo.next();
      Number idSkup = (Number) row.getAttribute("IdKtgucetniskupina");

      if(dokladyModule.CARTESIS!=idSkup.intValue() || dokladyModule.isTopas(idDoklad))
      {
        if(first) first=false;
        else buf.append("|");

        buf.append("&nbsp;<a href=\"DokladVazbyParovani2.jsp?idDoklad="+idDoklad+"&idSkup="+idSkup+"\" title=\"Párování nespárovaných vazeb\">"+idSkup+"</a>&nbsp;");
      }
    }
    vo.closeRowSet();
  }

  /**
   * 
   * Gets the attribute value for the calculated attribute FrontaClass
   */
  public String getFrontaClass()
  {
    String ret = "frontaWhite";
    
    ViewObject vo = getApplicationModule().findViewObject("VwKpDokladfrontaView1");
    vo.clearCache();
    vo.setWhereClause("IDSPOLECNOST = "+getId());
    while(vo.hasNext()) 
    {
      Row row = vo.next();
      String stav = (String) row.getAttribute("SStav");
      if(stav!=null) {
        if(stav.startsWith("Gen")) ret = "frontaGreen";
        if(stav.startsWith("Exp")) ret = "frontaGreen";
        if(stav.startsWith("Èek")) ret = "frontaYellow";
        if(stav.startsWith("DB")) ret = "frontaRed";
      }
    }
    vo.closeRowSet();
    
    return ret;
  }

  /**
   * 
   * Sets <code>value</code> as the attribute value for the calculated attribute FrontaClass
   */
  public void setFrontaClass(String value)
  {
    setAttributeInternal(FRONTACLASS, value);
  }

  /**
   * 
   * Gets the attribute value for the calculated attribute DirVse
   */
  public String getDirVse()
  {
    whereDoklad = "ID_KTGUCETNISPOLECNOST = " + getId() +
              "and NL_KROK in (1,2,90) ";
    return getDokladyHtml();
  }

  /**
   * 
   * Sets <code>value</code> as the attribute value for the calculated attribute DirVse
   */
  public void setDirVse(String value)
  {
    setAttributeInternal(DIRVSE, value);
  }

  private String getStyleLink(String name) 
  {
    String style = "";
    if(name.indexOf("2007_")>-1) return "style='color: orange'";
    if(name.indexOf("Mis")>-1) return "style='color: green'";
    if(name.startsWith("Bilance-") ||
       name.startsWith("BilanceIFRS-")) 
    {
      return "style='background-color: #CFFFCF;"+style+"'";
    }
    if(name.startsWith("Vazby_") ||
       name.startsWith("Bilance_") ||
       name.startsWith("Bilance-") ||
       name.startsWith("BilanceIFRS_") ||
       name.startsWith("BilanceIFRS-") ||
       name.startsWith("BilanceDetail") ||
       name.startsWith("BilanceIFRSDetail")
       ) 
    {
      return "style='"+style+"'";
    }
    else {
      return "style='background-color: #FFFFAF;"+style+"'";
    }
  }

  /**
   * 
   * Gets the attribute value for the calculated attribute MisEnabled
   */
  public Boolean getMisEnabled()
  {
    Boolean me = (Boolean)getAttributeInternal(MISENABLED);
    if(me==null) return Boolean.FALSE;
    else return me;
  }

  /**
   * 
   * Sets <code>value</code> as the attribute value for the calculated attribute MisEnabled
   */
  public void setMisEnabled(Boolean value)
  {
    setAttributeInternal(MISENABLED, value);
  }

  /**
   * 
   * Gets the attribute value for ID_CISKATSPOL using the alias name IdCiskatspol
   */
  public Number getIdCiskatspol()
  {
    return (Number)getAttributeInternal(IDCISKATSPOL);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ID_CISKATSPOL using the alias name IdCiskatspol
   */
  public void setIdCiskatspol(Number value)
  {
    setAttributeInternal(IDCISKATSPOL, value);
  }

  /**
   * 
   * Gets the attribute value for ZODPOVEDNAUCETNI using the alias name Zodpovednaucetni
   */
  public String getZodpovednaucetni()
  {
    return (String)getAttributeInternal(ZODPOVEDNAUCETNI);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ZODPOVEDNAUCETNI using the alias name Zodpovednaucetni
   */
  public void setZodpovednaucetni(String value)
  {
    setAttributeInternal(ZODPOVEDNAUCETNI, value);
  }

  /**
   * 
   * Gets the attribute value for ODPOVEDNAOSOBA using the alias name Odpovednaosoba
   */
  public String getOdpovednaosoba()
  {
    return (String)getAttributeInternal(ODPOVEDNAOSOBA);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ODPOVEDNAOSOBA using the alias name Odpovednaosoba
   */
  public void setOdpovednaosoba(String value)
  {
    setAttributeInternal(ODPOVEDNAOSOBA, value);
  }

  /**
   * 
   * Gets the attribute value for ADMINISTRATOR using the alias name Administrator
   */
  public String getAdministrator()
  {
    return (String)getAttributeInternal(ADMINISTRATOR);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for ADMINISTRATOR using the alias name Administrator
   */
  public void setAdministrator(String value)
  {
    setAttributeInternal(ADMINISTRATOR, value);
  }

  /**
   * 
   * Gets the attribute value for TOPMNG using the alias name Topmng
   */
  public String getTopmng()
  {
    return (String)getAttributeInternal(TOPMNG);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for TOPMNG using the alias name Topmng
   */
  public void setTopmng(String value)
  {
    setAttributeInternal(TOPMNG, value);
  }

  /**
   * 
   * Gets the attribute value for MNGSEGMENTBOSS using the alias name Mngsegmentboss
   */
  public String getMngsegmentboss()
  {
    return (String)getAttributeInternal(MNGSEGMENTBOSS);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for MNGSEGMENTBOSS using the alias name Mngsegmentboss
   */
  public void setMngsegmentboss(String value)
  {
    setAttributeInternal(MNGSEGMENTBOSS, value);
  }

  /**
   * 
   * Gets the attribute value for C_POCITEJMUPOZICI using the alias name CPocitejmupozici
   */
  public String getCPocitejmupozici()
  {
    return (String)getAttributeInternal(CPOCITEJMUPOZICI);
  }

  /**
   * 
   * Sets <code>value</code> as attribute value for C_POCITEJMUPOZICI using the alias name CPocitejmupozici
   */
  public void setCPocitejmupozici(String value)
  {
    setAttributeInternal(CPOCITEJMUPOZICI, value);
  }
}